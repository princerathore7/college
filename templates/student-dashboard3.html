<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student Dashboard ‚Äî Acropolis College</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
<style>
   .profile-box {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    padding: 20px;
    margin: 20px auto;
    width: 90%;
    max-width: 500px;
    text-align: center;
    font-family: 'Poppins', sans-serif;
  }
  .profile-box h2 {
    color: #4a148c;
    margin-bottom: 10px;
  }
  .profile-box p {
    font-size: 16px;
    margin: 5px 0;
  }
  body {
    font-family: 'Poppins', sans-serif;
    background: #f5f5f5;
    margin: 0;
    padding: 0;
    color: #3e2723;
  }
  header {
    background: linear-gradient(135deg,#008374,#006b98);
    color: #fff;
    padding: 15px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  }
  header img {
    height: 50px;
    border-radius: 8px;
  }
  header h1 {
    margin: 0;
    font-family: 'Playfair Display', serif;
    font-size: 1.8rem;
    letter-spacing: 1px;
  }
  nav button {
    background: #fff;
    color: #6d1b1b;
    border: none;
    padding: 8px 15px;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  nav button:hover {
    background: #ffd700;
    color: #3e2723;
  }
  main {
    padding: 25px 20px;
    max-width: 1200px;
    margin: auto;
  }
  .section {
    background: #fff;
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 20px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  .section h2 {
    font-family: 'Playfair Display', serif;
    color: #6d1b1b;
    margin-top: 0;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }
  table th, table td {
    padding: 10px;
    text-align: left;
    border-bottom: 1px solid #ccc;
  }
  table th {
    background: #f0e6e6;
    color: #6d1b1b;
  }
  .badge {
    padding: 4px 8px;
    border-radius: 6px;
    font-weight: 600;
    color: #fff;
  }
  .badge.present { background: #4caf50; }
  .badge.absent { background: #f44336; }
  .badge.pending { background: #ff9800; }
  .badge.paid { background: #2196f3; }
  .badge.due { background: #ff5722; }

  @media (max-width: 768px){
    table th, table td {
      font-size: 14px;
    }
    header h1 {
      font-size: 1.4rem;
    }
    nav button {
      padding: 6px 10px;
      font-size: 14px;
    }
  }
  
#eventsBanner {
  display: flex;
  overflow-x: auto;
  gap: 12px;
  padding: 8px;
  scroll-behavior: smooth;
}

.event-banner-img {
  width: 220px;
  height: 130px;
  border-radius: 10px;
  object-fit: cover;
  transition: transform 0.3s ease;
}

.event-banner-img:hover {
  transform: scale(1.05);
}

  /* üîπ Bus Route Button Styling */
.bus-route-btn {
  display: inline-block;
  background: linear-gradient(90deg, #007bff, #00c6ff);
  color: white;
  font-size: 1.1rem;
  font-weight: 600;
  padding: 12px 28px;
  border-radius: 8px;
  text-decoration: none;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  animation: floatButton 2.5s ease-in-out infinite;
  transition: all 0.3s ease;
}

.bus-route-btn:hover {
  background: linear-gradient(90deg, #0056b3, #0099cc);
  transform: scale(1.08);
  box-shadow: 0 6px 14px rgba(0,0,0,0.25);
}

/* üîπ Floating movement animation */
@keyframes floatButton {
  0%, 100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-6px);
  }
}
/* -------------------------
   NOTICE BUTTON STYLES
-------------------------- */
.notice-btn {
  position: relative;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: linear-gradient(135deg, #007bff, #0056d8);
  color: #fff;
  font-weight: 600;
  border: none;
  border-radius: 50px;
  padding: 10px 18px;
  font-size: 16px;
  cursor: pointer;
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
  transition: all 0.3s ease;
}

.notice-btn:hover {
  background: linear-gradient(135deg, #0056d8, #003eaa);
  transform: translateY(-2px);
}

/* Icon styling (bell or notice symbol) */
.notice-btn i {
  font-size: 18px;
}

/* Unread badge */
.notice-badge {
  position: absolute;
  top: -5px;
  right: -5px;
  background: #ff3b30;
  color: white;
  font-size: 12px;
  font-weight: 700;
  border-radius: 50%;
  padding: 3px 6px;
  min-width: 20px;
  text-align: center;
  box-shadow: 0 0 6px rgba(255, 59, 48, 0.6);
  animation: pulse 1.5s infinite;
}

/* Animation for badge */
@keyframes pulse {
  0% { transform: scale(1); opacity: 0.9; }
  50% { transform: scale(1.2); opacity: 1; }
  100% { transform: scale(1); opacity: 0.9; }
}
body {
  font-family: "Poppins", sans-serif;
  background: #f4f7fb;
  margin: 0;
  padding: 30px;
  color: #222;
}
.wrapper {
  max-width: 900px;
  margin: 0 auto;
  background: #fff;
  border-radius: 15px;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
  padding: 25px 30px;
}
h1 {
  text-align: center;
  color: #2c3e50;
  margin-bottom: 25px;
}
.timetable-card {
  background: #f9fafc;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
}
.pdf-frame {
  width: 100%;
  height: 600px;
  border: none;
  border-radius: 10px;
  margin-top: 10px;
}
.meta {
  color: #666;
  font-size: 14px;
  margin-bottom: 10px;
}
.no-data {
  text-align: center;
  color: #777;
  font-size: 15px;
  padding: 50px 0;
}
 /* ======== MODAL STYLING ======== */
  .openFeesBtn {
    background: #007bff;
    color: white;
    padding: 10px 18px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: 0.3s;
  }
  .openFeesBtn:hover { background: #0056b3; }

  .modal {
    display: none; /* Hidden by default */
    position: fixed;
    z-index: 1000;
    left: 0; top: 0;
    width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.5);
    justify-content: center; align-items: center;
  }
  .modal-content {
    background: #fff;
    padding: 25px 20px;
    border-radius: 12px;
    width: 350px;
    text-align: center;
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    position: relative;
    animation: fadeIn 0.3s ease;
  }
  @keyframes fadeIn {
    from { transform: scale(0.8); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }
  .close {
    position: absolute;
    top: 10px; right: 15px;
    font-size: 22px;
    cursor: pointer;
    color: #333;
  }
  .modal input {
    width: 100%;
    padding: 10px;
    margin-top: 15px;
    border: 1px solid #ccc;
    border-radius: 8px;
  }
  .modal button {
    margin-top: 10px;
    background: #007bff;
    color: white;
    border: none;
    padding: 10px;
    border-radius: 8px;
    width: 100%;
    cursor: pointer;
    transition: 0.3s;
  }
  .modal button:hover { background: #0056b3; }
  .result {
    margin-top: 15px;
    font-size: 16px;
  }
  .badge {
    padding: 4px 10px;
    border-radius: 8px;
    font-weight: 600;
    color: #fff;
    display: inline-block;
  }
  .paid { background: #28a745; }
  .pending { background: #dc3545; }
</style>
</head>
<body>
<header>
 
  <img src="logo.jpg" alt="Acropolis College Logo">
  <h1>Student Dashboard</h1>
  <div id="eventsBanner" style="display:flex; overflow-x:auto; gap:1rem; padding:1rem; background:#f0f4f8;">
  <!-- Event images will be dynamically loaded here -->
</div>
<nav>
    <button onclick="logout()">Logout</button>
  </nav>
  <h2 id="studentInfo"></h2>
</header>
<div id="student-profile" class="profile-box">
  <h2>Welcome, <span id="studentName">Loading...</span></h2>
  <p><strong>Enrollment:</strong> <span id="studentEnrollment"></span></p>
  <p><strong>Class:</strong> <span id="studentClass"></span></p>
</div>

<!-- Place inside body -->
<button id="noticeBtn" class="notice-btn">
  <i class="fa-solid fa-bell"></i> Notices
  <span class="notice-badge" id="unreadCount">3</span>
</button>
  <!-- Events Banner -->
  <div id="eventsBanner"></div>
  
<div id="attendance-info" class="profile-box">
  <h3>Attendance Summary</h3>
  <p><strong>Total Classes:</strong> <span id="attTotal">0</span></p>
  <p><strong>Present:</strong> <span id="attPresent">0</span></p>
  <p><strong>Attendance %:</strong> <span id="attPercent">0%</span></p>
</div>
<main>

  <!-- Attendance Section 
  <div class="section" id="attendanceSection">
    <h2>Attendance</h2>
    <table id="attendanceTable">
      <thead>
        <tr>
          <th>Date</th>
          <th>Status</th>
          <th>Marked By</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div> -->
<!-- üîπ Find Bus Route Button -->
<div style="text-align:center; margin-top: 30px;">
  <a href="bus-route.html" class="bus-route-btn">üöå Find Bus Route</a>
</div>

  <!-- Marks Section -->
<!-- Marks Section -->
<div class="section" id="marksSection">
  <h2>Marks</h2>
  <table>
    <tr><th>MST</th><td id="mstMarks">0</td></tr>
    <tr><th>Internal</th><td id="internalMarks">0</td></tr>
    <tr><th>Assignments</th><td id="assignmentMarks">0</td></tr>
  </table>

  <!-- üîπ View Marks Link -->
  <div style="text-align: right; margin-top: 12px;">
    <a href="marks-view.html" 
       style="
         background-color: #007bff;
         color: #fff;
         padding: 8px 16px;
         text-decoration: none;
         border-radius: 6px;
         font-weight: 500;
         transition: all 0.3s ease;
         box-shadow: 0 2px 4px rgba(0,0,0,0.15);
       "
       onmouseover="this.style.backgroundColor='#0056b3';"
       onmouseout="this.style.backgroundColor='#007bff';">
       View Full Marks ‚Üí
    </a>
  </div>
  <!-- Fees Section 
  <div class="section" id="feesSection">
    <h2>Fees</h2>
    <table>
      <tr><th>Total</th><td id="totalFees">‚Çπ0</td></tr>
      <tr><th>Paid</th><td id="paidFees">‚Çπ0</td></tr>
      <tr><th>Due</th><td id="dueFees">‚Çπ0</td></tr>
      <tr><th>Status</th><td id="feesStatus" class="badge pending">Pending</td></tr>
    </table>
  </div>-->
<!-- üîπ Fees Section -->
<div class="section" id="feesSection">
  <h2>Fees</h2>
  <button class="openFeesBtn" onclick="openFeesModal()">üí∞ Check Student Fees</button>

  <!-- Modal Window -->
  <div id="feesModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeFeesModal()">&times;</span>
      <h3>üéì Student Pending Fees Checker</h3>

      <input type="text" id="enrollmentInput" placeholder="Enter Enrollment Number" />
      <button onclick="fetchPendingFees()">Check Fees</button>

      <div class="result" id="resultBox"></div>
    </div>
  </div>
</div>

  <!-- Assignments Section -->
  <div class="section" id="assignmentsSection">
    <h2>Assignments</h2>
    <table id="assignmentsTable">
      <thead>
        <tr>
          <th>Title</th>
          <th>Subject</th>
          <th>Deadline</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Upcoming Exams Section -->
  <div class="section" id="examsSection">
    <h2>Upcoming Exams</h2>
    <table id="examsTable">
      <thead>
        <tr>
          <th>Exam</th>
          <th>Subject</th>
          <th>Date</th>
          <th>Room</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

<!-- Timetable Section -->
<body onload="loadTimetable()">
  <div class="wrapper">
    <h1>üìÖ Class Timetable</h1>
    <div id="timetableContainer" class="timetable-container">
      <!-- Timetable will load here -->
    </div>
  </div>
</body>


  <div class="container">
    <h2>üìò Class Timetable</h2>
    <div id="timetableContainer"></div>
    <a href="events.html" class="back-btn">‚¨Ö Back</a>
  </div>

      </thead>
      <tbody></tbody>
    </table>
  </div>

</main>

<script>
   // üîπ Open/Close Modal
  function openFeesModal() {
    document.getElementById("feesModal").style.display = "flex";
  }
  function closeFeesModal() {
    document.getElementById("feesModal").style.display = "none";
    document.getElementById("resultBox").innerHTML = "";
    document.getElementById("enrollmentInput").value = "";
  }

  // üîπ Fetch Pending Fees
  async function fetchPendingFees() {
    const enrollment = document.getElementById("enrollmentInput").value.trim();
    const resultBox = document.getElementById("resultBox");

    if (!enrollment) {
      resultBox.innerHTML = "<span style='color:red;'>‚ö†Ô∏è Please enter enrollment number.</span>";
      return;
    }

    resultBox.textContent = "‚è≥ Fetching fees...";

    try {
      const response = await fetch(`https://college-hwbb.onrender.com/api/students/${enrollment}/pending-fees?nocache=${Date.now()}`, {
        method: "GET",
        headers: { "Cache-Control": "no-cache" },
      });

      if (!response.ok) throw new Error(`Server returned ${response.status}`);
      const data = await response.json();

      if (data.success) {
        const pending = Number(data.pending_fees) || 0;

        if (pending > 0) {
          resultBox.innerHTML = `
            <p>üí∞ Pending Fees: <strong>‚Çπ${pending.toLocaleString()}</strong></p>
            <span class="badge pending">Pending</span>
          `;
        } else {
          resultBox.innerHTML = `
            <p>‚úÖ No pending fees!</p>
            <span class="badge paid">Paid</span>
          `;
        }
      } else {
        resultBox.innerHTML = `<span style='color:red;'>‚ö†Ô∏è Student not found.</span>`;
      }
    } catch (err) {
      console.error("Error fetching fees:", err);
      resultBox.innerHTML = `<span style='color:red;'>‚ùå Error connecting to server.</span>`;
    }
  }

  // Close modal on background click
  window.onclick = (event) => {
    const modal = document.getElementById("feesModal");
    if (event.target === modal) closeFeesModal();
  };
  // üîπ Logout Function
  function logout() {
    localStorage.removeItem("enrollment");
    localStorage.removeItem("studentClass");
    window.location.href = "student-login.html";
  }

  // üîπ Branch-wise total fees map
  const branchFees = {
    "IT": 140000,
    "CS": 135000,
    "EC": 130000,
    "ME": 125000,
    "1A": 50000,
    "1-A":50000,
    "2a":50000

  };

  // üîπ On Page Load
  document.addEventListener("DOMContentLoaded", async () => {
    const enrollment = localStorage.getItem("enrollment");
    if (!enrollment) {
      alert("Login required!");
      window.location.href = "student-login.html";
      return;
    }
function useStored(){
  const e = localStorage.getItem('enrollment');
  if(!e) return alert('No stored enrollment');
  document.getElementById('enr').value = e;
  loadMarks();
}

async function loadMarks(){
  const enr = document.getElementById('enr').value.trim();
  if(!enr) return alert('Enter enrollment');
  try{
    const res = await fetch(`https://college-hwbb.onrender.com/api/marks/${encodeURIComponent(enr)}`);
    if(!res.ok){
      const err = await res.json();
      return alert(err.message || 'Failed to fetch');
    }
    const data = await res.json();
    const m = data.marks;
    document.getElementById('studentName').innerText = `${m.name || 'Student'} ‚Äî ${m.enrollment}`;
    document.getElementById('mst').innerText = m.mst;
    document.getElementById('internal').innerText = m.internal;
    document.getElementById('assignments').innerText = m.assignments;
    document.getElementById('percentage').innerText = m.percentage + '%';
    document.getElementById('result').style.display = 'block';
  }catch(err){
    console.error(err);
    alert('Error loading marks');
  }
}
    // Load sections
    await loadStudentProfile(enrollment);
    await loadAttendance(enrollment);
    await loadAssignments(enrollment);
    await loadExamsAndTimetable();
    await loadFees(enrollment);
  });

  // üîπ Fetch and show student profile
  async function loadStudentProfile(enrollment) {
    try {
      const res = await fetch(`https://college-hwbb.onrender.com/api/students/${enrollment}/class`);
      const data = await res.json();

      if (res.ok && data.success) {
        const student = data.student;
        document.getElementById("studentName").textContent = student.name || "N/A";
        document.getElementById("studentEnrollment").textContent = student.enrollment;
        document.getElementById("studentClass").textContent = student.class || "Not Assigned";

        // ‚úÖ Save class to localStorage for later use
        localStorage.setItem("studentClass", student.class);
      } else {
        console.warn("Error fetching student info:", data.message);
      }
    } catch (err) {
      console.error("Error fetching profile:", err);
    }
  }

  // üîπ Load attendance
  async function loadAttendance(enrollment) {
    try {
      const res = await fetch(`https://college-hwbb.onrender.com/api/attendance/student/${enrollment}`);
      const data = await res.json();

      if (res.ok && data.success) {
        document.getElementById("attTotal").textContent = data.attendance.total;
        document.getElementById("attPresent").textContent = data.attendance.present;
        document.getElementById("attPercent").textContent = data.attendance.percentage + "%";
      } else {
        console.warn("Attendance not found");
      }
    } catch (err) {
      console.error("Error fetching attendance:", err);
    }
  }
  // üîπ Load assignments
  async function loadAssignments(enrollment) {
    try {
      // 1Ô∏è‚É£ Get student class (from localStorage or fetch if missing)
      let studentClass = localStorage.getItem("studentClass");
      if (!studentClass) {
        const stuRes = await fetch(`https://college-hwbb.onrender.com/api/students/${enrollment}/class`);
        const stuData = await stuRes.json();

        // Backend may store class under 'class' or 'branch'
        studentClass = stuData?.student?.class || stuData?.student?.branch || "IT";

        // Save in localStorage for next time
        localStorage.setItem("studentClass", studentClass);
      }

      // Normalize class for backend
      const branch = normalizeClassName(studentClass);
      console.log("üì¶ Fetching assignments for class:", branch);

      // 2Ô∏è‚É£ Fetch assignments for this class
      const assignmentsRes = await fetch(`https://college-hwbb.onrender.com/api/assignments/class/${branch}`);
      if (!assignmentsRes.ok) throw new Error("Failed to fetch assignments");
      const assignmentsData = await assignmentsRes.json();

      // 3Ô∏è‚É£ Populate table
      const assignmentsTable = document.getElementById('assignmentsTable').querySelector('tbody');
      assignmentsTable.innerHTML = '';

      if (assignmentsData.success && Array.isArray(assignmentsData.assignments)) {
        const assignments = assignmentsData.assignments;

        if (assignments.length === 0) {
          assignmentsTable.innerHTML = `<tr><td colspan="4" style="text-align:center; color:gray;">No assignments posted yet</td></tr>`;
        } else {
          assignments.forEach(a => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${a.title || 'N/A'}</td>
              <td>${a.subject || 'N/A'}</td>
              <td>${a.deadline || 'N/A'}</td>
              <td>${a.status || 'Pending'}</td>
            `;
            assignmentsTable.appendChild(tr);
          });
        }
      } else {
        assignmentsTable.innerHTML = `<tr><td colspan="4" style="text-align:center; color:red;">No assignments found</td></tr>`;
      }
    } catch (err) {
      console.error("Error fetching assignments:", err);
      const assignmentsTable = document.getElementById('assignmentsTable').querySelector('tbody');
      assignmentsTable.innerHTML = `<tr><td colspan="4" style="text-align:center; color:red;">Error fetching assignments</td></tr>`;
    }
  }

  // üîπ Normalize class name to match backend
  function normalizeClassName(str) {
    if (!str) return "IT";
    str = str.trim().toLowerCase();
    str = str.replace(/[^a-z0-9]/g, '');  // remove spaces, dashes, special chars
    str = str.replace(/st|nd|rd|th/g, ''); // remove ordinals
    return str.toUpperCase();               // backend expects uppercase, e.g. "1A", "IT"
  }

 // üîπ Load Fees Info (with guaranteed fresh data)
async function loadFees(enrollment) {
  try {
    // 1Ô∏è‚É£ Get student class
    const stuRes = await fetch(`https://college-hwbb.onrender.com/api/students/${enrollment}/class`, {
      cache: "no-store",
    });
    if (!stuRes.ok) throw new Error("Failed to fetch class info");
    const stuData = await stuRes.json();
    const branch = stuData?.student?.class || "IT";

    // 2Ô∏è‚É£ Fetch latest pending fees (force no cache)
    const res = await fetch(
      `https://college-hwbb.onrender.com/api/students/${enrollment}/pending-fees?timestamp=${Date.now()}`,
      {
        method: "GET",
        headers: {
          "Cache-Control": "no-cache, no-store, must-revalidate",
          Pragma: "no-cache",
          Expires: "0",
        },
      }
    );

    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();

    // 3Ô∏è‚É£ Parse and update UI
    if (data.success) {
      const pending = Number(data.pending_fees) || 0;
      const total = branchFees?.[branch] || 0;
      const paid = Math.max(total - pending, 0);

      document.getElementById("totalFees").textContent = `‚Çπ${total.toLocaleString()}`;
      document.getElementById("paidFees").textContent = `‚Çπ${paid.toLocaleString()}`;
      document.getElementById("dueFees").textContent = `‚Çπ${pending.toLocaleString()}`;

      const statusEl = document.getElementById("feesStatus");
      if (pending > 0) {
        statusEl.textContent = "Pending";
        statusEl.className = "badge pending";
      } else {
        statusEl.textContent = "Paid";
        statusEl.className = "badge paid";
      }

      console.log(`‚úÖ Fetched fees for ${enrollment}: Pending ‚Çπ${pending}`);
    } else {
      console.warn("‚ö†Ô∏è Unexpected response:", data);
      document.getElementById("dueFees").textContent = "Error";
    }
  } catch (err) {
    console.error("‚ùå Error fetching fees:", err);
    document.getElementById("dueFees").textContent = "Error fetching fees";
  }
}

 // üîπ Load exams and timetable (with backend fetch)
async function loadExamsAndTimetable() {
  const examsTable = document.getElementById('examsTable').querySelector('tbody');
  const timetableTable = document.getElementById('timetableTable').querySelector('tbody');

  // Clear existing rows
  examsTable.innerHTML = '';
  timetableTable.innerHTML = '';

  // --- Fetch exams from backend ---
  let exams = [];
  try {
    
const API_BASE = "https://college-hwbb.onrender.com/api/timetables";

    const res = await fetch('https://college-hwbb.onrender.com/api/exams');
    const data = await res.json();
    if (res.ok && data.success && Array.isArray(data.exams)) {
      exams = data.exams.map(e => ({
        exam: e.examName,
        subject: e.subject,
        date: e.date,
        room: e.room
      }));
    } else {
      console.warn('No exams found in backend, using fallback');
      exams = [{ exam: 'Mid-Term', subject: 'DBMS', date: '2025-12-15', room: 'Hall 2' }];
    }
  } catch (err) {
    console.error('Error fetching exams from backend:', err);
    exams = [{ exam: 'Mid-Term', subject: 'DBMS', date: '2025-12-15', room: 'Hall 2' }];
  }
}
  // Populate exams table
  exams.forEach(e => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${e.exam}</td><td>${e.subject}</td><td>${e.date}</td><td>${e.room}</td>`;
    examsTable.appendChild(tr);
  });

  // --- Static timetable data (or you can fetch from backend similarly) ---
  const timetable = [
    { day: 'Monday', period: '1', subject: 'DBMS', room: '101' },
    { day: 'Monday', period: '2', subject: 'Maths', room: '102' },
  ];
// üîπ Load timetable automatically when page opens
async function loadTimetable() {
  // Get class name from localStorage or prompt user once
  let className = localStorage.getItem("studentClass");
  if (!className) {
    className = prompt("Enter your class (e.g., 1A, 2B, 10C):");
    if (!className) return alert("Class not specified!");
    localStorage.setItem("studentClass", className.trim());
  }

  const container = document.getElementById("timetableContainer");
  container.innerHTML = "<p>‚è≥ Fetching timetable...</p>";

  try {
    const res = await fetch(`${API_BASE}?class=${encodeURIComponent(className)}`);
    const data = await res.json();

    if (!data.success || !data.timetables || data.timetables.length === 0) {
      container.innerHTML = `
        <div class="no-data">
          <p>No timetable uploaded yet for <strong>${className}</strong>.</p>
        </div>`;
      return;
    }

    // Pick latest timetable (last uploaded)
    const latest = data.timetables[data.timetables.length - 1];
    const fileUrl = `${API_BASE}/${latest.timetableId}/file`;

    container.innerHTML = `
      <div class="timetable-card">
        <h3>üìò Class: ${latest.class}</h3>
        <p class="meta">Uploaded on: ${new Date(latest.uploadedAt).toLocaleString()}</p>
        <iframe src="${fileUrl}" class="pdf-frame" allowfullscreen></iframe>
      </div>
    `;
  } catch (err) {
    console.error("Error loading timetable:", err);
    container.innerHTML = `<p style="color:red;">‚ùå Failed to load timetable. Check console.</p>`;
  }
}
  // üîπ Login success helper
  function onStudentLoginSuccess(enrollment) {
    localStorage.setItem("enrollment", enrollment);
    window.location.href = "student-dashboard.html";
  }

async function loadEventsBanner() {
  try {
    const res = await fetch("https://college-hwbb.onrender.com/api/events");
    const data = await res.json();
    const banner = document.getElementById("eventsBanner");
    banner.innerHTML = "";

    if (data.success && Array.isArray(data.events) && data.events.length > 0) {
      data.events.forEach(ev => {
        const img = document.createElement("img");
        img.src = ev.image || "placeholder.jpg";
        img.alt = ev.title;
        img.title = ev.title;
        img.className = "event-banner-img"; // optional CSS class
        img.style.cursor = "pointer";

        // üü¢ Click ‚Üí open event details page
        img.addEventListener("click", () => {
          window.location.href = `events.html?eventId=${ev.eventId}`;
        });

        banner.appendChild(img);
      });
    } else {
      banner.innerHTML = `<p style="color:gray;">No upcoming events</p>`;
    }
  } catch (err) {
    console.error("Error loading events:", err);
    const banner = document.getElementById("eventsBanner");
    banner.innerHTML = `<p style="color:red;">Failed to load events</p>`;
  }
}

// üöÄ Auto-load events on dashboard load
document.addEventListener("DOMContentLoaded", loadEventsBanner);
// Example: for student with enrollment 24
loadUnreadCount("students", "24");

// Redirect to notice.html when clicked
document.getElementById("noticeBtn").addEventListener("click", ()=>{
  window.location.href = `notice-read.html?userType=students&enrollment=24`;
});
document.addEventListener("DOMContentLoaded", () => {
  loadEventsBanner();  // your existing function
});

</script>

</body>
</html>
