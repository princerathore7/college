<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Post Assignments — Acropolis College</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
<style>
/* ---------------- RESET ---------------- */
* {box-sizing: border-box; margin:0; padding:0; font-family: 'Poppins', sans-serif;}
body {background: #f6f8fb; color: #222; overflow-y: auto;}

/* ---------------- HEADER ---------------- */
header {
    background: linear-gradient(135deg,#004d40,#009688);
    color: #fff;
    padding: 14px 18px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    box-shadow: 0 2px 10px rgba(0,0,0,0.12);
    position: sticky;
    top: 0;
    z-index: 1000;
}
header h1 {font-family: 'Playfair Display', serif; font-size: 1.4rem;}
header .back-btn, header .logout-btn {
    padding: 8px 14px;
    border-radius: 6px;
    border: none;
    font-weight: 600;
    cursor: pointer;
    transition: 0.2s;
}
header .back-btn {background:#fff; color:#004d40; margin-right:10px;}
header .back-btn:hover {background:#b2dfdb;}
header .logout-btn {background:#fff; color:#004d40;}
header .logout-btn:hover {background:#b2dfdb;}

/* ---------------- MAIN ---------------- */
main {
    max-width: 1000px;
    margin: 28px auto;
    padding: 20px;
}
.section {
    background: #fff;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 6px 14px rgba(0,0,0,0.06);
    margin-bottom: 20px;
}
h2.section-title {font-family: 'Playfair Display', serif; color: #004d40; margin-bottom: 12px;}

/* ---------------- FORM ---------------- */
form {display: flex; flex-direction: column; gap: 10px;}
form label {font-weight: 500;}
form input, form select {padding: 10px; border-radius: 8px; border:1px solid #ccc;}
button.submitBtn {
    background:#004d40;
    color:#fff;
    padding:10px;
    border:none;
    border-radius:8px;
    font-weight:600;
    cursor:pointer;
    transition:0.3s;
}
button.submitBtn:hover {background:#009688;}
button.submitBtn:disabled {opacity:0.6; cursor:not-allowed;}
.message {margin-top:10px; font-weight:600;}

/* ---------------- TABLE ---------------- */
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}
table th, table td {
    padding: 10px;
    border-bottom:1px solid #eee;
    text-align:left;
}
table th {background:#e0f2f1; color:#004d40;}
button.deleteBtn {
    background:#f44336;
    color:#fff;
    border:none;
    padding:6px 12px;
    border-radius:6px;
    cursor:pointer;
    font-weight:600;
}
button.deleteBtn:hover {background:#d32f2f;}

/* ---------------- RESPONSIVE ---------------- */
@media (max-width: 900px) {
    header h1 {font-size:1.2rem;}
}
@media (max-width:600px) {
    header {padding:10px;}
    button.submitBtn {padding:8px;}
    table th, table td {padding:6px; font-size:0.85rem;}
}
</style>
</head>
<body>

<header>
    <div>
        <button class="back-btn" onclick="goBack()">← Back</button>
        <h1>Post Assignment</h1>
    </div>
    <button class="logout-btn" onclick="logout()">Logout</button>
</header>

<main>
    <div class="section">
        <h2 class="section-title">Add New Assignment</h2>
        <form id="assignmentForm">
            <label for="class">Class / Branch</label>
            <input type="text" id="class" placeholder="e.g. 1yearIT1 = 1st year IT 1" required>

            <label for="title">Assignment Title</label>
            <input type="text" id="title" placeholder="Assignment title" required>

            <label for="subject">Subject</label>
            <input type="text" id="subject" placeholder="Subject name" required>

            <label for="deadline">Deadline</label>
            <input type="date" id="deadline" required>

            <button type="submit" class="submitBtn">Post Assignment</button>
        </form>
        <div class="message" id="message"></div>
    </div>

    <div class="section">
        <h2 class="section-title">All Posted Assignments</h2>
        <table id="postedAssignmentsTable">
            <thead>
                <tr>
                    <th>Class</th>
                    <th>Title</th>
                    <th>Subject</th>
                    <th>Deadline</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <tr><td colspan="5" style="text-align:center; color:gray;">Loading...</td></tr>
            </tbody>
        </table>
    </div>
</main>

<script>
function logout() {
    localStorage.removeItem("mentorLoggedIn");
    localStorage.removeItem("mentorBranch");
    window.location.href = "mentor-login.html";
}
function goBack() { window.history.back(); }

// ✅ Fetch all assignments
async function fetchPostedAssignments() {
    try {
        const res = await fetch(`https://college-hwbb.onrender.com/api/assignments`);
        const data = await res.json();
        const tbody = document.getElementById("postedAssignmentsTable").querySelector("tbody");
        tbody.innerHTML = '';
        if(res.ok && data.success && data.assignments.length>0){
            data.assignments.forEach(a=>{
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${a.class}</td>
                    <td>${a.title}</td>
                    <td>${a.subject}</td>
                    <td>${a.deadline}</td>
                    <td><button class="deleteBtn" onclick="deleteAssignment('${a.assignmentId}')">Delete</button></td>
                `;
                tbody.appendChild(tr);
            });
        } else {
            tbody.innerHTML = `<tr><td colspan="5" style="text-align:center; color:gray;">No assignments posted yet</td></tr>`;
        }
    } catch(err){
        console.error(err);
        const tbody = document.getElementById("postedAssignmentsTable").querySelector("tbody");
        tbody.innerHTML = `<tr><td colspan="5" style="text-align:center; color:red;">Error fetching assignments</td></tr>`;
    }
}

// ✅ Delete assignment
async function deleteAssignment(id){
    if(!confirm("Are you sure?")) return;
    try{
        const res = await fetch(`https://college-hwbb.onrender.com/api/assignments/${id}`,{method:"DELETE"});
        const data = await res.json();
        if(res.ok && data.success){ alert("Deleted successfully"); fetchPostedAssignments(); }
        else alert(data.message || "Error deleting assignment");
    }catch(err){console.error(err); alert("Server error");}
}

// ✅ Post new assignment
document.getElementById("assignmentForm").addEventListener("submit", async e=>{
    e.preventDefault();
    const className = document.getElementById("class").value.trim().toUpperCase();
    const title = document.getElementById("title").value.trim();
    const subject = document.getElementById("subject").value.trim();
    const deadline = document.getElementById("deadline").value;

    if(!className||!title||!subject||!deadline){
        const msg = document.getElementById("message");
        msg.textContent="All fields required!";
        msg.style.color="red"; return;
    }

    const submitBtn = document.querySelector(".submitBtn");
    submitBtn.disabled = true;
    const msg = document.getElementById("message");
    msg.textContent = "Processing your request...";
    msg.style.color = "green";

    try{
        const res = await fetch(`https://college-hwbb.onrender.com/api/assignments`,{
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({class:className,title,subject,deadline})
        });
        const data = await res.json();
        if(res.ok && data.success){
            msg.textContent = "Assignment posted successfully!";
            msg.style.color = "green";
            document.getElementById("assignmentForm").reset();
            fetchPostedAssignments();
        } else {
            msg.textContent = data.message || "Error posting assignment";
            msg.style.color = "red";
        }
    } catch(err){
        console.error(err);
        msg.textContent="Server connection error";
        msg.style.color="red";
    } finally{
        submitBtn.disabled = false;
    }
});

// Fetch assignments on load
document.addEventListener("DOMContentLoaded", fetchPostedAssignments);
</script>
</body>
</html>
