<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Post Assignments — Admin</title>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;font-family:Poppins,sans-serif}
body{margin:0;background:#f4f7fb}

/* HEADER */
header{
  background:linear-gradient(135deg,#001f3f,#003366);
  color:#fff;
  padding:14px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
header h1{font-family:Playfair Display;font-size:1.4rem}
header button{
  padding:8px 14px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-weight:600;
}
.back-btn{background:#fff;color:#001f3f}
.logout-btn{background:#fff;color:#001f3f}

/* MAIN */
main{max-width:1000px;margin:30px auto;padding:20px}
.section{
  background:#fff;
  padding:20px;
  border-radius:12px;
  box-shadow:0 6px 16px rgba(0,0,0,.08);
  margin-bottom:20px;
}
.section-title{
  font-family:Playfair Display;
  color:#001f3f;
  margin-bottom:15px;
}

/* FORM */
form{display:flex;flex-direction:column;gap:10px}
label{font-weight:500}
input,select{
  padding:10px;
  border-radius:8px;
  border:1px solid #ccc;
}
.submitBtn{
  background:#001f3f;
  color:#fff;
  padding:10px;
  border:none;
  border-radius:8px;
  font-weight:600;
  cursor:pointer;
}
.submitBtn:hover{background:#003366}
.message{margin-top:10px;font-weight:600}

/* TABLE */
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{padding:10px;border-bottom:1px solid #eee}
th{background:#e3ecf7;color:#001f3f}
.deleteBtn{
  background:#d32f2f;
  color:#fff;
  border:none;
  padding:6px 12px;
  border-radius:6px;
  cursor:pointer;
}
.deleteBtn:hover{background:#b71c1c}
</style>
</head>

<body>

<header>
  <button class="back-btn" onclick="history.back()">← Back</button>
  <h1>Post Assignments</h1>
  <button class="logout-btn" onclick="logout()">Logout</button>
</header>

<main>

<!-- ADD ASSIGNMENT -->
<div class="section">
<h2 class="section-title">Add New Assignment</h2>

<form id="assignmentForm">

<label>Year</label>
<select id="year">
  <option value="">Select Year</option>
  <option value="1">1st Year</option>
  <option value="2">2nd Year</option>
  <option value="3">3rd Year</option>
  <option value="4">4th Year</option>
</select>

<label>Branch</label>
<select id="branch">
  <option value="">Select Branch</option>
  <option value="CSE">CSE</option>
  <option value="IT">IT</option>
  <option value="AIML">AIML</option>
  <option value="DS">DS</option>
    <option value="IT1">IT1</option>
    <option value="IT2">IT2</option>
    <option value="IT3">IT3</option>
    <option value="IT4">IT4</option>
    <option value="IT5">IT5</option>
    
    <option value="AIML1">AIML1</option>
    <option value="AIML2">AIML2</option>
    <option value="AIML3">AIML3</option>
    <option value="AIML4">AIML4</option>
    <option value="AIML5">AIML5</option>
    
    <option value="AIDS1">AIDS1</option>
    <option value="AIDS2">AIDS2</option>
    <option value="AIDS3">AIDS3</option>
    <option value="AIDS4">AIDS4</option>
    <option value="AIDS5">AIDS5</option>
    
    <option value="CSBS1">CSBS1</option>
    <option value="CSBS2">CSBS2</option>
    <option value="CSBS3">CSBS3</option>
    <option value="CSBS4">CSBS4</option>
    <option value="CSBS5">CSBS5</option>

    <option value="IOT1">IOT1</option>
    <option value="IOT2">IOT2</option>
    <option value="IOT3">IOT3</option>
    <option value="IOT4">IOT4</option>
    <option value="IOT5">IOT5</option>
    
    <option value="ECE1">ECE1</option>
    <option value="ECE2">ECE2</option>
    <option value="ECE3">ECE3</option>
    <option value="ECE4">ECE4</option>
    <option value="ECE5">ECE5</option>

    <option value="EEE1">EEE1</option>
    <option value="EEE2">EEE2</option>
    <option value="EEE3">EEE3</option>
    <option value="EEE4">EEE4</option>
    <option value="EEE5">EEE5</option>

    <option value="EE1">EE1</option>
    <option value="EE2">EE2</option>
    <option value="EE3">EE3</option>
    <option value="EE4">EE4</option>
    <option value="EE5">EE5</option>

    <option value="ME1">ME1</option>
    <option value="ME2">ME2</option>
    <option value="ME3">ME3</option>
    <option value="ME4">ME4</option>
    <option value="ME5">ME5</option>

    <option value="AU1">AU1</option>
    <option value="AU2">AU2</option>
    <option value="AU3">AU3</option>
    <option value="AU4">AU4</option>
    <option value="AU5">AU5</option>

    <option value="MT1">MT1</option>
    <option value="MT2">MT2</option>
    <option value="MT3">MT3</option>
    <option value="MT4">MT4</option>
    <option value="MT5">MT5</option>

    <option value="CE1">CE1</option>
    <option value="CE2">CE2</option>
    <option value="CE3">CE3</option>
    <option value="CE4">CE4</option>
    <option value="CE5">CE5</option>

    <option value="CHE1">CHE1</option>
    <option value="CHE2">CHE2</option>
    <option value="CHE3">CHE3</option>
    <option value="CHE4">CHE4</option>
    <option value="CHE5">CHE5</option>

    <option value="MIN1">MIN1</option>
    <option value="MIN2">MIN2</option>
    <option value="MIN3">MIN3</option>
    <option value="MIN4">MIN4</option>
    <option value="MIN5">MIN5</option>

    <option value="PET1">PET1</option>
    <option value="PET2">PET2</option>
    <option value="PET3">PET3</option>
    <option value="PET4">PET4</option>
    <option value="PET5">PET5</option>

    <option value="BT1">BT1</option>
    <option value="BT2">BT2</option>
    <option value="BT3">BT3</option>
    <option value="BT4">BT4</option>
    <option value="BT5">BT5</option>

    <option value="BME1">BME1</option>
    <option value="BME2">BME2</option>
    <option value="BME3">BME3</option>
    <option value="BME4">BME4</option>
    <option value="BME5">BME5</option>

    <option value="FT1">FT1</option>
    <option value="FT2">FT2</option>
    <option value="FT3">FT3</option>
    <option value="FT4">FT4</option>
    <option value="FT5">FT5</option>

    <option value="AG1">AG1</option>
    <option value="AG2">AG2</option>
    <option value="AG3">AG3</option>
    <option value="AG4">AG4</option>
    <option value="AG5">AG5</option>

    <option value="ENV1">ENV1</option>
    <option value="ENV2">ENV2</option>
    <option value="ENV3">ENV3</option>
    <option value="ENV4">ENV4</option>
    <option value="ENV5">ENV5</option>

    <option value="TX1">TX1</option>
    <option value="TX2">TX2</option>
    <option value="TX3">TX3</option>
    <option value="TX4">TX4</option>
    <option value="TX5">TX5</option>

    <option value="PIE1">PIE1</option>
    <option value="PIE2">PIE2</option>
    <option value="PIE3">PIE3</option>
    <option value="PIE4">PIE4</option>
    <option value="PIE5">PIE5</option>

    <option value="IM1">IM1</option>
    <option value="IM2">IM2</option>
    <option value="IM3">IM3</option>
    <option value="IM4">IM4</option>
    <option value="IM5">IM5</option>
</select>

<label>Section</label>
<select id="section">
  <option value="">Select Section</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
</select>

<label>Title</label>
<input id="title" required>

<label>Subject</label>
<input id="subject" required>

<label>Deadline</label>
<input type="date" id="deadline" required>

<button class="submitBtn">Post Assignment</button>
</form>

<div class="message" id="message"></div>
</div>

<!-- LIST -->
<div class="section">
<h2 class="section-title">Posted Assignments</h2>
<table>
<thead>
<tr>
<th>Class</th>
<th>Title</th>
<th>Subject</th>
<th>Deadline</th>
<th>Action</th>
</tr>
</thead>
<tbody id="assignmentTable">
<tr><td colspan="5" style="text-align:center">Loading...</td></tr>
</tbody>
</table>
</div>

</main>

<script>
/* ACCESS CONTROL */
const mentorId = localStorage.getItem("mentorId");
const src = sessionStorage.getItem("accessSource");
if(!mentorId || !["ad","admin"].includes(src)){
  document.body.innerHTML="<h2 style='text-align:center;margin-top:20vh;color:red'>Unauthorized</h2>";
  throw "";
}

function logout(){
  localStorage.clear();
  sessionStorage.clear();
  location.href="mentor-login.html";
}

/* FETCH */
async function fetchAssignments(){
  const tbody=document.getElementById("assignmentTable");
  const res=await fetch("https://college-hwbb.onrender.com/api/assignments");
  const data=await res.json();
  tbody.innerHTML="";
  if(data.assignments.length===0){
    tbody.innerHTML="<tr><td colspan='5' style='text-align:center'>No assignments</td></tr>";
    return;
  }
  data.assignments.forEach(a=>{
    tbody.innerHTML+=`
    <tr>
      <td>${a.class}</td>
      <td>${a.title}</td>
      <td>${a.subject}</td>
      <td>${a.deadline}</td>
      <td><button class="deleteBtn" onclick="deleteAssignment('${a.assignmentId}')">Delete</button></td>
    </tr>`;
  });
}

/* DELETE */
async function deleteAssignment(id){
  if(!confirm("Delete this assignment?")) return;
  const res=await fetch(`https://college-hwbb.onrender.com/api/assignments/${id}`,{method:"DELETE"});
  const data=await res.json();
  if(data.success){
    alert("Deleted");
    fetchAssignments();
  }
}

/* POST */
document.getElementById("assignmentForm").onsubmit=async e=>{
  e.preventDefault();
  const y=year.value,b=branch.value,s=section.value;
  if(!y||!b||!s){alert("Select class properly");return;}
  const className=`${y}${b}${s}`;

  const res=await fetch("https://college-hwbb.onrender.com/api/assignments",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      class:className,
      title:title.value,
      subject:subject.value,
      deadline:deadline.value
    })
  });

  const data=await res.json();
  message.textContent=data.success?"Assignment Posted":"Error";
  message.style.color=data.success?"green":"red";
  if(data.success){assignmentForm.reset();fetchAssignments();}
};

fetchAssignments();
</script>

</body>
</html>
