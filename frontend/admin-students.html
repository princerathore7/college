<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin — Students Management</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#f4f6fb;
  --card:#ffffff;
  --accent:#4f46e5;
  --muted:#6b7280;
  --green:#16a34a;
  --yellow:#ca8a04;
  --red:#dc2626;
}
body{
  margin:0;
  font-family:Inter,system-ui,sans-serif;
  background:var(--bg);
  color:#111;
}

header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  background:var(--card);
  padding:12px 20px;
  border-bottom:1px solid #e6e9f2;
  position:sticky;
  top:0;
  z-index:1000;
}
header img{height:45px;margin-right:12px}
header h1{font-size:20px;margin:0}
header button{
  background:var(--accent);
  color:#fff;
  border:0;
  padding:8px 14px;
  border-radius:8px;
  cursor:pointer;
}

main{padding:20px;max-width:1400px;margin:auto}

.controls{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  margin-bottom:16px;
  align-items:center;
}
.controls select,.controls button{
  padding:6px 10px;
  border-radius:6px;
  border:1px solid #ccc;
  font-size:14px;
}
.controls button{
  background:var(--accent);
  color:#fff;
  border:none;
  cursor:pointer;
}

table{
  width:100%;
  border-collapse:collapse;
  background:var(--card);
  border-radius:8px;
  overflow:hidden;
  box-shadow:0 4px 12px rgba(0,0,0,.08)
}
th,td{
  padding:10px 12px;
  font-size:14px;
  border-bottom:1px solid #eee;
}
th{background:#f1f3f8}
.no-data{text-align:center;color:#888;padding:20px}

.badge{
  padding:4px 8px;
  border-radius:12px;
  font-weight:600;
  font-size:12px;
  color:#fff;
}
.green{background:var(--green)}
.yellow{background:var(--yellow)}
.red{background:var(--red)}

@media(max-width:900px){
  .controls{flex-direction:column;align-items:flex-start}
}
</style>
</head>

<body>

<header>
  <div style="display:flex;align-items:center">
    <img src="logo.jpg" alt="Logo">
    <h1>Admin — Students</h1>
  </div>
  <button onclick="logout()">Logout</button>
</header>

<main>

<div class="controls">
  <select id="year">
    <option value="">All Years</option>
    <option value="1">1st</option>
    <option value="2">2nd</option>
    <option value="3">3rd</option>
    <option value="4">4th</option>
  </select>

  <select id="branch">
    <option value="">All Branches</option>
    <option>CSE</option>
    <option>IT</option>
    <option>AIML</option>
    <option>ECE</option>
    <option>ME</option>
    <option>CE</option>
  </select>

  <select id="section">
    <option value="">All Sections</option>
    <option>1</option>
    <option>2</option>
    <option>3</option>
    <option>4</option>
    <option>5</option>
  </select>

  <button id="refreshBtn">Refresh</button>
</div>

<table>
<thead>
<tr>
  <th>Enrollment</th>
  <th>Name</th>
  <th>Year</th>
  <th>Branch</th>
  <th>Section</th>
  <th>Attendance</th>
  <th>Pending Fees</th>
  <th>Fine</th>
</tr>
</thead>
<tbody id="studentsBody">
<tr><td colspan="8" class="no-data">Loading...</td></tr>
</tbody>
</table>

</main>

<script>
const API_ROOT = "https://college-hwbb.onrender.com/api/admin/students";

function logout(){
  localStorage.clear();
  location.href="login.html";
}

async function fetchStudents(refresh=false){
  if(!refresh){
    const cache = localStorage.getItem("adminStudents");
    if(cache) return JSON.parse(cache);
  }
  try{
    const res = await fetch(API_ROOT);
    const data = await res.json();
    if(data.success){
      localStorage.setItem("adminStudents", JSON.stringify(data.students));
      return data.students;
    }
  }catch(e){
    console.error(e);
  }
  return [];
}

function attendanceBadge(att){
  if(!att || att.percentage === undefined) return "—";
  let cls = att.percentage >= 75 ? "green" :
            att.percentage >= 60 ? "yellow" : "red";
  return `<span class="badge ${cls}">${att.percentage}%</span>`;
}

function renderStudents(students){
  const tbody = document.getElementById("studentsBody");

  const y = year.value, b = branch.value, s = section.value;
  const filtered = students.filter(st =>
    (!y || st.year == y) &&
    (!b || st.branch == b) &&
    (!s || st.section == s)
  );

  if(!filtered.length){
    tbody.innerHTML = `<tr><td colspan="8" class="no-data">No students found</td></tr>`;
    return;
  }

  tbody.innerHTML = filtered.map(st => `
    <tr>
      <td>${st.enrollment}</td>
      <td>${st.name}</td>
      <td>${st.year}</td>
      <td>${st.branch}</td>
      <td>${st.section}</td>
      <td>${attendanceBadge(st.attendance)}</td>
      <td>₹ ${st.pendingFees ?? 0}</td>
      <td>₹ ${st.fine ?? 0}</td>
    </tr>
  `).join("");
}

async function load(refresh=false){
  const data = await fetchStudents(refresh);
  renderStudents(data);
}

["year","branch","section"].forEach(id=>{
  document.getElementById(id).addEventListener("change",()=>load());
});

refreshBtn.onclick = ()=> load(true);

document.addEventListener("DOMContentLoaded",()=>load());
</script>

</body>
</html>
