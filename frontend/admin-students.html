<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin — Students Management</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#f4f6fb; --card:#ffffff; --accent:#4f46e5; --muted:#6b7280;
}
body{margin:0;font-family:Inter,system-ui,sans-serif;background:var(--bg);color:#111}
header{display:flex;align-items:center;justify-content:space-between;background:var(--card);padding:12px 20px;border-bottom:1px solid #e6e9f2;position:sticky;top:0;z-index:1000}
header img{height:50px;object-fit:contain;margin-right:12px}
header h1{font-size:20px;margin:0}
header button{background:var(--accent);color:#fff;border:0;padding:8px 14px;border-radius:8px;cursor:pointer}

main{padding:20px;max-width:1400px;margin:0 auto}

.controls{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:16px;align-items:center}
.controls select,input, .controls button{padding:6px 10px;border-radius:6px;border:1px solid #ccc;font-size:14px}
.controls button{background:var(--accent);color:#fff;border:none;cursor:pointer}

table{width:100%;border-collapse:collapse;background:var(--card);border-radius:8px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,0.08)}
table th, table td{padding:8px 12px;text-align:left;border-bottom:1px solid #eee;font-size:14px}
table th{background:#f0f0f0}
.no-data{text-align:center;color:#888;padding:20px}

@media(max-width:900px){
  .controls{flex-direction:column;align-items:flex-start}
}
</style>
</head>
<body>

<header>
  <div style="display:flex;align-items:center">
    <img src="logo.jpg" alt="Acropolis Logo">
    <h1>Admin — Students</h1>
  </div>
  <button onclick="logout()">Logout</button>
</header>

<main>
  <div class="controls">
    <label>Select Year
      <select id="year">
        <option value="">All Years</option>
        <option value="1">1st Year</option>
        <option value="2">2nd Year</option>
        <option value="3">3rd Year</option>
        <option value="4">4th Year</option>
      </select>
    </label>

    <label>Select Branch
      <select id="branch">
        <option value="">All Branches</option>
        <option value="CSE">CSE</option>
        <option value="IT">IT</option>
        <option value="AIML">AIML</option>
        <option value="ECE">ECE</option>
        <option value="ME">ME</option>
        <option value="CE">CE</option>
        <!-- Add more branches as needed -->
      </select>
    </label>

    <label>Select Section
      <select id="section">
        <option value="">All Sections</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
      </select>
    </label>

    <button id="refreshBtn">Refresh Students Data</button>
  </div>

  <table>
    <thead>
      <tr>
        <th>Enrollment</th>
        <th>Name</th>
        <th>Year</th>
        <th>Branch</th>
        <th>Section</th>
        <th>Attendance</th>
        <th>Pending Fees</th>
        <th>Fine</th>
      </tr>
    </thead>
    <tbody id="studentsBody">
      <tr><td colspan="8" class="no-data">Loading students data...</td></tr>
    </tbody>
  </table>
</main>

<script>
const API_ROOT = "https://college-hwbb.onrender.com/api";

// Logout function
function logout(){
  localStorage.clear();
  window.location.href='login.html';
}

// Fetch all students data from API
async function fetchStudents(refresh=false){
  const localData = localStorage.getItem('allStudents');
  if(localData && !refresh){
    return JSON.parse(localData);
  }
  try{
    const res = await fetch(`${API_ROOT}/students`);
    const data = await res.json();
    if(data.success && Array.isArray(data.students)){
      localStorage.setItem('allStudents', JSON.stringify(data.students));
      return data.students;
    } else return [];
  }catch(err){
    console.error('Error fetching students:',err);
    return [];
  }
}

// Render students table
function renderStudents(students){
  const tbody = document.getElementById('studentsBody');
  if(!students || students.length===0){
    tbody.innerHTML = `<tr><td colspan="8" class="no-data">No students found.</td></tr>`;
    return;
  }

  const yearFilter = document.getElementById('year').value;
  const branchFilter = document.getElementById('branch').value;
  const sectionFilter = document.getElementById('section').value;

  const filtered = students.filter(s=>{
    return (!yearFilter || s.year==yearFilter)
      && (!branchFilter || s.branch==branchFilter)
      && (!sectionFilter || s.section==sectionFilter);
  });

  if(filtered.length===0){
    tbody.innerHTML = `<tr><td colspan="8" class="no-data">No students match the selected filters.</td></tr>`;
    return;
  }

  tbody.innerHTML = '';
  filtered.forEach(s=>{
    tbody.innerHTML += `<tr>
      <td>${s.enrollment}</td>
      <td>${s.name}</td>
      <td>${s.year}</td>
      <td>${s.branch}</td>
      <td>${s.section}</td>
      <td>${s.attendance ?? '—'}</td>
      <td>${s.pendingFees ?? '—'}</td>
      <td>${s.fine ?? '—'}</td>
    </tr>`;
  });
}

// Initial load
async function loadStudents(refresh=false){
  const students = await fetchStudents(refresh);
  renderStudents(students);
}

// Filters change
document.getElementById('year').addEventListener('change', ()=> loadStudents());
document.getElementById('branch').addEventListener('change', ()=> loadStudents());
document.getElementById('section').addEventListener('change', ()=> loadStudents());

// Refresh button
document.getElementById('refreshBtn').addEventListener('click', ()=> loadStudents(true));

// Load on page load
document.addEventListener('DOMContentLoaded', ()=> loadStudents());
</script>

</body>
</html>
