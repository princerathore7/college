<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Exam Ring — Mentor Dashboard</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
:root {
  --primary:#0b3c5d;
  --primary-dark:#06293f;
  --success:#2ecc71;
  --danger:#e53935;
}

body {
  font-family:'Inter',sans-serif;
  background:#f3f4f6;
  margin:0;
}

header {
  background:var(--primary);
  color:#fff;
  padding:1.5rem;
  text-align:center;
  box-shadow:0 3px 12px rgba(0,0,0,.15);
}

main {
  max-width:900px;
  margin:2rem auto;
  background:#fff;
  padding:2rem;
  border-radius:16px;
  box-shadow:0 12px 30px rgba(0,0,0,.06);
}

h2 {
  color:var(--primary);
  border-left:4px solid var(--primary);
  padding-left:10px;
}

label {
  font-weight:600;
  margin-top:1rem;
  display:block;
}

input, select {
  width:100%;
  padding:.7rem;
  margin-top:.3rem;
  border-radius:8px;
  border:1px solid #ddd;
  transition:.3s;
}

input:focus, select:focus {
  outline:none;
  border-color:var(--primary);
  box-shadow:0 0 0 3px rgba(11,60,93,.15);
}

.input-grid {
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:15px;
}

/* BUTTON + PROGRESS */
#postBtn {
  width:100%;
  margin-top:1.5rem;
  background:var(--primary);
  color:#fff;
  padding:.9rem;
  border:none;
  border-radius:10px;
  font-size:1rem;
  font-weight:600;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:10px;
}

#postBtn:disabled {
  background:#9fb3c4;
  cursor:not-allowed;
}

.spinner {
  width:18px;
  height:18px;
  border:3px solid rgba(255,255,255,.4);
  border-top:3px solid #fff;
  border-radius:50%;
  animation:spin .8s linear infinite;
  display:none;
}

@keyframes spin { to{ transform:rotate(360deg);} }

/* PROGRESS BAR */
.progress-box {
  margin-top:10px;
  display:none;
}

.progress-bar {
  height:8px;
  background:#e0e0e0;
  border-radius:20px;
  overflow:hidden;
}

.progress-fill {
  height:100%;
  width:0%;
  background:linear-gradient(90deg,var(--primary),var(--success));
  transition:width .3s;
}

.progress-text {
  font-size:.8rem;
  margin-top:4px;
  text-align:right;
}

/* TABLE */
table {
  width:100%;
  border-collapse:collapse;
  margin-top:2rem;
}

th,td {
  padding:12px;
  border-bottom:1px solid #eee;
}

th {
  background:#f6f9fc;
  color:var(--primary);
}

.delete-btn {
  background:var(--danger);
  color:#fff;
  border:none;
  padding:6px 12px;
  border-radius:6px;
  cursor:pointer;
}

.delete-btn:hover { background:#c62828; }

/* SUCCESS OVERLAY */
#successOverlay {
  position:fixed;
  inset:0;
  background:rgba(255,255,255,.9);
  display:none;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  z-index:999;
}

.check {
  width:80px;
  height:80px;
  background:var(--success);
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  animation:pop .4s ease;
}

@keyframes pop {
  from{transform:scale(0);}
  to{transform:scale(1);}
}

.check svg {
  width:45px;
  fill:#fff;
}
</style>
</head>

<body>

<div id="successOverlay">
  <div class="check">
    <svg viewBox="0 0 24 24">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
  </div>
  <h2 style="border:none;margin-top:20px">Exam Posted Successfully</h2>
</div>

<header>
  <h1>Exam Ring — Mentor Dashboard</h1>
</header>

<main>

<h2>Post New Exam</h2>

<div class="input-grid">
  <div>
    <label>Year</label>
    <select id="year">
      <option value="">Select</option>
      <option value="1">1st Year</option>
      <option value="2">2nd Year</option>
      <option value="3">3rd Year</option>
      <option value="4">4th Year</option>
    </select>
  </div>

  <div>
    <label>Branch</label>
    <select id="branch">
      <option value="">Select</option>
      <option value="CSE">CSE</option>
      <option value="IT">IT</option>
      <option value="AIML">AIML</option>
      <option value="DS">DS</option>
        <option value="IT1">IT1</option>
    <option value="IT2">IT2</option>
    <option value="IT3">IT3</option>
    <option value="IT4">IT4</option>
    <option value="IT5">IT5</option>
    
    <option value="AIML1">AIML1</option>
    <option value="AIML2">AIML2</option>
    <option value="AIML3">AIML3</option>
    <option value="AIML4">AIML4</option>
    <option value="AIML5">AIML5</option>
    
    <option value="AIDS1">AIDS1</option>
    <option value="AIDS2">AIDS2</option>
    <option value="AIDS3">AIDS3</option>
    <option value="AIDS4">AIDS4</option>
    <option value="AIDS5">AIDS5</option>
    
    <option value="CSBS1">CSBS1</option>
    <option value="CSBS2">CSBS2</option>
    <option value="CSBS3">CSBS3</option>
    <option value="CSBS4">CSBS4</option>
    <option value="CSBS5">CSBS5</option>

    <option value="IOT1">IOT1</option>
    <option value="IOT2">IOT2</option>
    <option value="IOT3">IOT3</option>
    <option value="IOT4">IOT4</option>
    <option value="IOT5">IOT5</option>
    
    <option value="ECE1">ECE1</option>
    <option value="ECE2">ECE2</option>
    <option value="ECE3">ECE3</option>
    <option value="ECE4">ECE4</option>
    <option value="ECE5">ECE5</option>

    <option value="EEE1">EEE1</option>
    <option value="EEE2">EEE2</option>
    <option value="EEE3">EEE3</option>
    <option value="EEE4">EEE4</option>
    <option value="EEE5">EEE5</option>

    <option value="EE1">EE1</option>
    <option value="EE2">EE2</option>
    <option value="EE3">EE3</option>
    <option value="EE4">EE4</option>
    <option value="EE5">EE5</option>

    <option value="ME1">ME1</option>
    <option value="ME2">ME2</option>
    <option value="ME3">ME3</option>
    <option value="ME4">ME4</option>
    <option value="ME5">ME5</option>

    <option value="AU1">AU1</option>
    <option value="AU2">AU2</option>
    <option value="AU3">AU3</option>
    <option value="AU4">AU4</option>
    <option value="AU5">AU5</option>

    <option value="MT1">MT1</option>
    <option value="MT2">MT2</option>
    <option value="MT3">MT3</option>
    <option value="MT4">MT4</option>
    <option value="MT5">MT5</option>

    <option value="CE1">CE1</option>
    <option value="CE2">CE2</option>
    <option value="CE3">CE3</option>
    <option value="CE4">CE4</option>
    <option value="CE5">CE5</option>

    <option value="CHE1">CHE1</option>
    <option value="CHE2">CHE2</option>
    <option value="CHE3">CHE3</option>
    <option value="CHE4">CHE4</option>
    <option value="CHE5">CHE5</option>

    <option value="MIN1">MIN1</option>
    <option value="MIN2">MIN2</option>
    <option value="MIN3">MIN3</option>
    <option value="MIN4">MIN4</option>
    <option value="MIN5">MIN5</option>

    <option value="PET1">PET1</option>
    <option value="PET2">PET2</option>
    <option value="PET3">PET3</option>
    <option value="PET4">PET4</option>
    <option value="PET5">PET5</option>

    <option value="BT1">BT1</option>
    <option value="BT2">BT2</option>
    <option value="BT3">BT3</option>
    <option value="BT4">BT4</option>
    <option value="BT5">BT5</option>

    <option value="BME1">BME1</option>
    <option value="BME2">BME2</option>
    <option value="BME3">BME3</option>
    <option value="BME4">BME4</option>
    <option value="BME5">BME5</option>

    <option value="FT1">FT1</option>
    <option value="FT2">FT2</option>
    <option value="FT3">FT3</option>
    <option value="FT4">FT4</option>
    <option value="FT5">FT5</option>

    <option value="AG1">AG1</option>
    <option value="AG2">AG2</option>
    <option value="AG3">AG3</option>
    <option value="AG4">AG4</option>
    <option value="AG5">AG5</option>

    <option value="ENV1">ENV1</option>
    <option value="ENV2">ENV2</option>
    <option value="ENV3">ENV3</option>
    <option value="ENV4">ENV4</option>
    <option value="ENV5">ENV5</option>

    <option value="TX1">TX1</option>
    <option value="TX2">TX2</option>
    <option value="TX3">TX3</option>
    <option value="TX4">TX4</option>
    <option value="TX5">TX5</option>

    <option value="PIE1">PIE1</option>
    <option value="PIE2">PIE2</option>
    <option value="PIE3">PIE3</option>
    <option value="PIE4">PIE4</option>
    <option value="PIE5">PIE5</option>

    <option value="IM1">IM1</option>
    <option value="IM2">IM2</option>
    <option value="IM3">IM3</option>
    <option value="IM4">IM4</option>
    <option value="IM5">IM5</option>
    </select>
  </div>

  <div>
    <label>Section</label>
    <select id="section">
      <option value="">Select</option>
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
    </select>
  </div>
</div>

<label>Exam Name</label>
<input id="examName">

<label>Subject</label>
<input id="subject">

<div class="input-grid" style="grid-template-columns:1fr 1fr">
  <div>
    <label>Date</label>
    <input type="date" id="date">
  </div>
  <div>
    <label>Room / Description</label>
    <input id="room">
  </div>
</div>

<button id="postBtn" onclick="postExam()">
  <div class="spinner" id="spinner"></div>
  <span id="btnText">Post Exam</span>
</button>

<div class="progress-box" id="progressBox">
  <div class="progress-bar">
    <div class="progress-fill" id="progressFill"></div>
  </div>
  <div class="progress-text" id="progressText">0%</div>
</div>

<h2 style="margin-top:3rem">Upcoming Exams</h2>

<table>
<thead>
<tr>
  <th>Exam</th><th>Subject</th><th>Date</th><th>Room</th><th>Class</th><th>Action</th>
</tr>
</thead>
<tbody id="examTable">
<tr><td colspan="6" style="text-align:center">Loading...</td></tr>
</tbody>
</table>

</main>

<script>
  
/* ===============================
   ACCESS CONTROL — ADMIN PAGES
================================ */

const mentorId = localStorage.getItem("mentorId");
const source   = sessionStorage.getItem("accessSource");

// allowed sources
const ALLOWED_SOURCES = ["ad", "admin"];

if(!mentorId || !ALLOWED_SOURCES.includes(source)){
  document.body.innerHTML = `
    <h2 style="text-align:center;margin-top:20vh;color:red">
      ❌ Access Denied <br>
      Please open this page via Administration Panel
    </h2>
  `;
  throw new Error("Unauthorized access");
}
async function fetchExams(){
  const res = await fetch("https://college-hwbb.onrender.com/api/exams");
  const data = await res.json();
  const tbody = examTable;
  tbody.innerHTML = "";

  if(!data.success || data.exams.length===0){
    tbody.innerHTML="<tr><td colspan='6' style='text-align:center'>No exams</td></tr>";
    return;
  }

  data.exams.forEach(e=>{
    tbody.innerHTML+=`
      <tr>
        <td>${e.examName}</td>
        <td>${e.subject}</td>
        <td>${e.date}</td>
        <td>${e.room}</td>
        <td>${e.class}</td>
        <td><button class="delete-btn" onclick="deleteExam('${e.examId}')">Delete</button></td>
      </tr>`;
  });
}

async function postExam(){
  const y=year.value,b=branch.value,s=section.value;
  if(!y||!b||!s) return alert("Select Year, Branch & Section");

  const payload={
    examName:examName.value.trim(),
    subject:subject.value.trim(),
    date:date.value,
    room:room.value.trim(),
    class:`${y}${b}${s}`
  };

  if(Object.values(payload).some(v=>!v)) return alert("Fill all fields");

  postBtn.disabled=true;
  spinner.style.display="block";
  progressBox.style.display="block";

  let progress=0;
  const interval=setInterval(()=>{
    progress+=Math.floor(Math.random()*12);
    if(progress>95) progress=95;
    progressFill.style.width=progress+"%";
    progressText.innerText=progress+"%";
  },200);

  const res=await fetch("https://college-hwbb.onrender.com/api/exams",{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify(payload)
  });

  clearInterval(interval);
  progressFill.style.width="100%";
  progressText.innerText="100%";

  const data=await res.json();
  spinner.style.display="none";
  postBtn.disabled=false;

  if(data.success){
    successOverlay.style.display="flex";
    setTimeout(()=>{
      successOverlay.style.display="none";
      progressBox.style.display="none";
      progressFill.style.width="0%";
      progressText.innerText="0%";
      document.querySelectorAll("input,select").forEach(e=>e.value="");
      fetchExams();
    },1500);
  } else alert(data.message);
}

async function deleteExam(id){
  if(!confirm("Delete this exam?")) return;
  const res=await fetch(`https://college-hwbb.onrender.com/api/exams/${id}`,{method:"DELETE"});
  const data=await res.json();
  if(data.success) fetchExams();
}

fetchExams();
</script>

</body>
</html>
