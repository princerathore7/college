<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bus Routes PDF</title>
<style>
body { font-family: Arial, sans-serif; background: #f0f0f0; padding: 40px; }
.container { max-width: 500px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; }
h2 { text-align: center; }
input[type="file"] { display: block; margin: 20px auto; }
button { display: block; margin: 20px auto; padding: 10px 20px; }
a { display: block; text-align: center; margin-top: 20px; }
#message { text-align: center; color: green; margin-top: 10px; }
</style>
</head>
<body>

<div class="container">
    <h2>Bus Routes PDF</h2>
    <input type="file" id="pdfInput" accept="application/pdf">
    <button onclick="uploadPDF()">Upload PDF</button>
    <a id="viewLink" href="#" target="_blank" style="display:none;">View Current Bus PDF</a>
    <div id="message"></div>
</div>

<script>
    /* ===============================
   ACCESS CONTROL — ADMIN PANEL
================================ */

const mentorId = localStorage.getItem("mentorId");
const fromAdmin = sessionStorage.getItem("fromAdminPanel");

if(!mentorId || fromAdmin !== "yes"){
  document.body.innerHTML = `
    <h2 style="text-align:center;margin-top:20vh;color:red">
      ❌ Access Denied <br>
      Please open this page from Administration Panel only
    </h2>
  `;
  throw new Error("Unauthorized access");
}
const API_ROOT = "https://college-hwbb.onrender.com/api/bus";

async function uploadPDF() {
    const input = document.getElementById("pdfInput");
    const file = input.files[0];
    const msg = document.getElementById("message");

    if (!file) {
        msg.style.color = "red";
        msg.innerText = "Please select a PDF file!";
        return;
    }

    msg.style.color = "black";
    msg.innerText = "Uploading...";

    const formData = new FormData();
    formData.append("pdf", file);

    try {
        const res = await fetch(`${API_ROOT}/upload`, {
            method: "POST",
            body: formData
        });

        const data = await res.json();

        if (data.success) {
            msg.style.color = "green";
            msg.innerHTML = `Uploaded successfully! <br>PDF URL: <a href="${data.pdf_url}" target="_blank">${data.pdf_url}</a>`;
            showViewLink(data.pdf_url);
        } else {
            msg.style.color = "red";
            msg.innerText = data.message;
        }
    } catch (err) {
        console.error(err);
        msg.style.color = "red";
        msg.innerText = "Error uploading PDF";
    }
}

// Show link to current Cloudinary PDF
function showViewLink(pdfUrl = null) {
    const viewLink = document.getElementById("viewLink");
    if (pdfUrl) {
        viewLink.href = pdfUrl;
        viewLink.style.display = "block";
        viewLink.innerText = "View Current Bus PDF";
    } else {
        // Fetch from backend default URL
        fetch(`${API_ROOT}/view`).then(res => res.json()).then(data => {
            if (data.success && data.pdf_url) {
                viewLink.href = data.pdf_url;
                viewLink.style.display = "block";
                viewLink.innerText = "View Current Bus PDF";
            } else {
                viewLink.style.display = "none";
            }
        }).catch(() => viewLink.style.display = "none");
    }
}

// On page load, show current PDF link
window.onload = () => showViewLink();
</script>

</body>
</html>
