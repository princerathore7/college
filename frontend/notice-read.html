<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ðŸ“¢ Student Notices</title>
<style>
  body { font-family: Inter, sans-serif; background:#f3f4f6; padding:20px }
  .card { max-width:800px; margin:auto; background:#fff; padding:20px; border-radius:12px; box-shadow:0 3px 12px rgba(0,0,0,0.1) }
  h1 { text-align:center; margin-bottom:16px }
  .notice { border:1px solid #eee; border-radius:8px; padding:12px; margin-bottom:12px; background:#f9fafb }
  .notice h3 { margin:0 0 6px 0; color:#2563eb }
  .meta { font-size:12px; color:#666; margin-top:6px }
  img { max-width:100%; border-radius:6px; margin-top:8px }
  .top-bar { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px }
  .btn { padding:6px 12px; border-radius:6px; border:none; cursor:pointer; background:#e0e7ff }
</style>
</head>
<body>

<div class="card">
  <div class="top-bar">
    <h1>ðŸ“¢ Notices</h1>
    <button class="btn" onclick="toggleView()">View All</button>
  </div>

  <div id="classInfo"></div>
  <div id="notices"></div>
</div>

<script>
const API_ROOT = "https://college-hwbb.onrender.com";
let viewAll = false;

// Get optional class from URL or localStorage
const studentClass = new URLSearchParams(window.location.search).get("class") || localStorage.getItem("studentClass");
document.getElementById("classInfo").textContent = studentClass ? `Class: ${studentClass}` : "All Students";

// Toggle "View All"
function toggleView() {
  viewAll = !viewAll;
  loadNotices();
}

async function loadNotices(){
  try {
    const enrollment = localStorage.getItem("enrollment"); // optional
    const res = await fetch(`${API_ROOT}/api/notices?target=students`);
    if(!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();

    if(!data.success || !data.notices) throw new Error("No notices found");

    renderNotices(data.notices, enrollment, studentClass);

  } catch(err){
    console.error("Notice load error:", err);
    document.getElementById("notices").innerHTML = `<p style="color:red">Notices not available right now</p>`;
  }
}

function renderNotices(list, enrollment, studentClass){
  const div = document.getElementById("notices");
  div.innerHTML = "";

  const filtered = list.filter(n => {
    if(viewAll) return true;
    if(!studentClass) return true;
    return n.targetClass === studentClass || n.targetClass === "ALL";
  });

  if(filtered.length === 0){
    div.innerHTML = `<p>No notices for ${studentClass || "students"}</p>`;
    return;
  }

  filtered.forEach(n=>{
    div.innerHTML += `
      <div class="notice">
        <h3>${n.title}</h3>
        <p>${n.message}</p>
        ${n.imageUrl ? `<img src="${n.imageUrl}">` : ""}
        <div class="meta">By ${n.sender} | ${new Date(n.timestamp).toLocaleString()}</div>
      </div>
    `;
  });
}

// Initial load
window.onload = loadNotices;

</script>
</body>
</html>
