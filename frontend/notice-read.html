<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ðŸ“¢ Student Notices</title>
<style>
  body { font-family: Inter, sans-serif; background:#f3f4f6; padding:20px; margin:0 }
  .card { max-width:800px; margin:auto; background:#fff; padding:20px; border-radius:12px; box-shadow:0 3px 12px rgba(0,0,0,0.1) }
  h1 { text-align:center; margin-bottom:16px }
  .notice { border:1px solid #eee; border-radius:8px; padding:12px; margin-bottom:12px; background:#f9fafb }
  .notice h3 { margin:0 0 6px 0; color:#2563eb }
  .meta { font-size:12px; color:#666; margin-top:6px }
  img { max-width:100%; border-radius:6px; margin-top:8px }
  .top-bar { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px }
  .btn { padding:6px 12px; border-radius:6px; border:none; cursor:pointer; background:#e0e7ff }

  /* ------------- Loader Styles ------------- */
  #loader {
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    background: rgba(255,255,255,0.8);
    display: flex;
    justify-content:center;
    align-items:center;
    z-index:9999;
  }

  /* 3D rotating cube loader */
  .cube {
    width: 50px;
    height: 50px;
    position: relative;
    transform-style: preserve-3d;
    animation: rotateCube 1.5s infinite linear;
  }
  .cube div {
    position: absolute;
    width: 50px;
    height: 50px;
    background: #6d1b1b;
    opacity: 0.8;
    border-radius: 6px;
  }
  .cube div:nth-child(1) { transform: rotateX(0deg) translateZ(25px); }
  .cube div:nth-child(2) { transform: rotateY(90deg) translateZ(25px); }
  .cube div:nth-child(3) { transform: rotateY(180deg) translateZ(25px); }
  .cube div:nth-child(4) { transform: rotateY(-90deg) translateZ(25px); }
  .cube div:nth-child(5) { transform: rotateX(90deg) translateZ(25px); }
  .cube div:nth-child(6) { transform: rotateX(-90deg) translateZ(25px); }

  @keyframes rotateCube {
    0% { transform: rotateX(0deg) rotateY(0deg); }
    100% { transform: rotateX(360deg) rotateY(360deg); }
  }
</style>
</head>
<body>

<!-- Loader element -->
<div id="loader">
  <div class="cube">
    <div></div><div></div><div></div>
    <div></div><div></div><div></div>
  </div>
</div>

<div class="card">
  <div class="top-bar">
    <h1>ðŸ“¢ Notices</h1>
    <button class="btn" onclick="toggleView()">View All</button>
  </div>

  <div id="classInfo"></div>
  <div id="notices"></div>
</div>

<script>
const API_ROOT = "https://college-hwbb.onrender.com";
let viewAll = false;

// Get optional class from URL or localStorage
const studentClass = new URLSearchParams(window.location.search).get("class") || localStorage.getItem("studentClass");
document.getElementById("classInfo").textContent = studentClass ? `Class: ${studentClass}` : "All Students";

// Toggle between filtered and all notices
function toggleView() {
  viewAll = !viewAll;
  loadNotices();
}

// Show loader
function showLoader() {
  document.getElementById("loader").style.display = "flex";
}

// Hide loader
function hideLoader() {
  document.getElementById("loader").style.display = "none";
}

// Load notices from API
async function loadNotices(){
  showLoader(); // show loader at start
  try {
    const enrollment = localStorage.getItem("enrollment"); // optional
    const res = await fetch(`${API_ROOT}/api/notices?target=students`);
    if(!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();

    if(!data.success || !data.notices) throw new Error("No notices found");

    renderNotices(data.notices, enrollment, studentClass);

  } catch(err){
    console.error("Notice load error:", err);
    document.getElementById("notices").innerHTML = `<p style="color:red">Notices not available right now</p>`;
  } finally {
    hideLoader(); // hide loader when done
  }
}

// Render notice cards dynamically
function renderNotices(list, enrollment, studentClass){
  const div = document.getElementById("notices");
  div.innerHTML = "";

  const filtered = list.filter(n => {
    if(viewAll) return true;
    if(!studentClass) return true;
    return n.targetClass === studentClass || n.targetClass === "ALL";
  });

  if(filtered.length === 0){
    div.innerHTML = `<p>No notices for ${studentClass || "students"}</p>`;
    return;
  }

  filtered.forEach(n=>{
    div.innerHTML += `
      <div class="notice">
        <h3>${n.title}</h3>
        <p>${n.message}</p>
        ${n.imageUrl ? `<img src="${n.imageUrl}">` : ""}
        <div class="meta">By ${n.sender} | ${new Date(n.timestamp).toLocaleString()}</div>
      </div>
    `;
  });
}

// Initial load on page load
window.onload = loadNotices;

</script>
</body>
</html>
