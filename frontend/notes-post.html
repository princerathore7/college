<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Upload Notes — Mentor Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
  body { font-family: Inter, sans-serif; background:#eef2f7; padding:30px; }
  .card { max-width:850px; background:#fff; margin:auto; padding:25px; border-radius:10px; box-shadow:0 4px 16px rgba(0,0,0,0.1); }
  label { font-weight:600; display:block; margin-top:12px; }
  input, select { width:100%; padding:10px; margin-top:5px; border:1px solid #ccc; border-radius:6px; }
  button { width:100%; padding:12px; margin-top:18px; background:#2563eb; color:#fff; border:none; border-radius:6px; cursor:pointer; font-size:15px; font-weight:600; }
  .note-item { border-bottom:1px solid #ddd; padding:12px; background:#f9f9f9; margin-top:12px; border-radius:6px; }
  .action-btn { padding:6px 12px; border:none; border-radius:6px; cursor:pointer; }
  .view { background:#16a34a; color:#fff; }
  .delete { background:#dc2626; color:#fff; margin-left:6px; }
</style>
</head>
<body>

<div class="card">
<h2>Upload Notes / Assignments</h2>

<label>Title</label>
<input type="text" id="title">

<label>Subject</label>
<input type="text" id="subject">

<label>Deadline (Optional)</label>
<input type="date" id="deadline">

<label>Select Year</label>
<select id="year">
  <option value="">-- select year --</option>
  <option value="1">1st Year</option>
  <option value="2">2nd Year</option>
  <option value="3">3rd Year</option>
  <option value="4">4th Year</option>
</select>

<label>Select Branch</label>
<select id="branch">
 <option value="CSE">CSE - Computer Science Engineering</option>
<option value="IT">IT - Information Technology</option>
<option value="AIML">AIML - Artificial Intelligence & Machine Learning</option>
<option value="AIDS">AIDS - Artificial Intelligence & Data Science</option>
<option value="CSBS">CSBS - Computer Science & Business Systems</option>
<option value="IOT">IoT - Internet of Things</option>

<option value="ECE">ECE - Electronics & Communication</option>
<option value="EEE">EEE - Electrical & Electronics</option>
<option value="EE">EE - Electrical Engineering</option>

<option value="ME">ME - Mechanical Engineering</option>
<option value="AU">AU - Automobile Engineering</option>
<option value="MT">MT - Mechatronics</option>

<option value="CE">CE - Civil Engineering</option>
<option value="CHE">CHE - Chemical Engineering</option>
<option value="MIN">MIN - Mining Engineering</option>
<option value="PET">PET - Petroleum Engineering</option>

<option value="BT">BT - Biotechnology</option>
<option value="BME">BME - Biomedical Engineering</option>

<option value="FT">FT - Food Technology</option>
<option value="AG">AG - Agriculture Engineering</option>

<option value="ENV">ENV - Environmental Engineering</option>
<option value="TX">TX - Textile Engineering</option>

<option value="PIE">PIE - Production & Industrial Engineering</option>
<option value="IM">IM - Industrial Management</option>
<option value="DPHARMA">D.Pharmacy</option>
<option value="BPHARMA">B.Pharmacy</option>
<option value="MPHARMA">M.Pharmacy</option>
<option value="PHARMA-CHEM">Pharmaceutical Chemistry</option>
<option value="PHARMA-ANALYTICAL">Pharmaceutical Analysis</option>
<option value="PHARMA-QUALITY">Quality Assurance</option>
<option value="PHARMA-PHARMACO">Pharmacology</option>
<option value="PHARMA-PHARMACEUTICS">Pharmaceutics</option>
<option value="PHARMA-BIOTECH">Pharmaceutical Biotechnology</option>
<option value="PHARMA-REGULATORY">Regulatory Affairs</option>
<option value="DCSE">Diploma - Computer Science Engineering</option>
<option value="DIT">Diploma - Information Technology</option>
<option value="DCYBER">Diploma - Cyber Security</option>

<option value="DECE">Diploma - Electronics & Communication Engineering</option>
<option value="DEEE">Diploma - Electrical & Electronics Engineering</option>
<option value="DEE">Diploma - Electrical Engineering</option>

<option value="DME">Diploma - Mechanical Engineering</option>
<option value="DCE">Diploma - Civil Engineering</option>
<option value="DMIN">Diploma - Mining Engineering</option>

<option value="DCHE">Diploma - Chemical Engineering</option>
<option value="DAG">Diploma - Agriculture Engineering</option>
<option value="DTX">Diploma - Textile Technology</option>
<option value="DPLASTIC">Diploma - Plastic Engineering</option>
<option value="DPOLY">Diploma - Polymer Engineering</option>

</select>

<label>Select Section</label>
<select id="section">
  <option value="">-- select section --</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="5">5</option>
</select>

<label>Upload PDF File</label>
<input type="file" id="file" accept="application/pdf">

<button onclick="uploadNote()">Upload</button>

<hr style="margin:25px 0;">

<h3>Uploaded Notes</h3>
<div id="notesList"></div>

</div>

<script>
  
const API = "https://college-hwbb.onrender.com/api/notes";

    /* ===============================
   ACCESS CONTROL — ADMIN PAGES
================================ */

const mentorId = localStorage.getItem("mentorId");
const source   = sessionStorage.getItem("accessSource");

// allowed sources
const ALLOWED_SOURCES = ["ad", "admin"];

if(!mentorId || !ALLOWED_SOURCES.includes(source)){
  document.body.innerHTML = `
    <h2 style="text-align:center;margin-top:20vh;color:red">
      ❌ Access Denied <br>
      Please open this page via Administration Panel
    </h2>
  `;
  throw new Error("Unauthorized access");
}
function normalizeClass(y,b,s){ return (y+b+s).toUpperCase(); }

async function uploadNote(){
  const title=document.getElementById("title").value.trim();
  const subject=document.getElementById("subject").value.trim();  
  const deadline=document.getElementById("deadline").value;
  const year=document.getElementById("year").value;
  const branch=document.getElementById("branch").value;
  const section=document.getElementById("section").value;
  const file=document.getElementById("file").files[0];

  if(!title || !subject || !year || !branch || !section || !file){
    alert("Fill all fields");
    return;
  }

  const className = normalizeClass(year,branch,section);

  const form = new FormData();
  form.append("title", title);
  form.append("subject", subject);
  form.append("deadline", deadline);
  form.append("class", className);
  form.append("file", file);

  const res = await fetch(API, { method:"POST", body:form });
  const data = await res.json();

  if(data.success){ alert("Uploaded"); loadNotes(); }
  else alert(data.message);
}

async function loadNotes(){
  const res = await fetch(API);
  const data = await res.json();
  const container = document.getElementById("notesList");
  container.innerHTML="";

  if(!data.success || data.notes.length===0){
    container.innerHTML="<p>No notes uploaded.</p>";
    return;
  }

  data.notes.forEach(n=>{
    container.innerHTML += `
      <div class="note-item">
        <strong>${n.title}</strong><br>
        <small>${n.subject} • Class: ${n.class.replace(/([0-9]+)([A-Z]+)([0-9]+)/,"$1 $2 $3")}</small><br>
        <button class="action-btn view" onclick="openPDF('${n.file_url}')">View</button>

        <button class="action-btn delete" onclick="deleteNote('${n.noteId}')">Delete</button>
      </div>
    `;
  });
}

function openPDF(url){
  // Cloudinary raw file URL me fl_attachment=false add karenge taaki browser me open ho
  const previewUrl = url.includes("?") ? url+"&fl_attachment=false" : url+"?fl_attachment=false";
  window.open(previewUrl, "_blank");
}

async function deleteNote(id){
  if(!confirm("Delete?")) return;
  const res = await fetch(`${API}/${id}`, { method:"DELETE" });
  const data = await res.json();
  if(data.success) loadNotes();
  else alert(data.message);
}

loadNotes();
</script>

</body>
</html>
