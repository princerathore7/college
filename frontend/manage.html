<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Manage Events - Mentor Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Inter', sans-serif; margin:0; padding:0; background:#f3f4f6; color:#333; }
  header { background:#4a90e2; color:white; padding:1rem 2rem; text-align:center; }
  main { max-width:1000px; margin:2rem auto; padding:1rem; background:white; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.1);}
  h1 { margin-top:0; }
  .event-card { border:1px solid #ccc; border-radius:8px; padding:1rem; margin-bottom:1rem; display:flex; align-items:center; justify-content:space-between; background:#fafafa; }
  .event-info { max-width:80%; }
  .event-info img { max-width:150px; border-radius:5px; margin-right:1rem; }
  button { background:#e74c3c; color:white; padding:0.5rem 1rem; border:none; border-radius:5px; cursor:pointer; font-weight:600; }
  button:hover { background:#c0392b; }
</style>
</head>
<body>

<header>
  <h1>Manage Events</h1>
</header>

<main id="eventsContainer">
  <!-- Event cards will be dynamically loaded here -->
</main>

<script>
  
    /* ===============================
   ACCESS CONTROL — ADMIN PAGES
================================ */

const mentorId = localStorage.getItem("mentorId");
const source   = sessionStorage.getItem("accessSource");

// allowed sources
const ALLOWED_SOURCES = ["ad", "admin"];

if(!mentorId || !ALLOWED_SOURCES.includes(source)){
  document.body.innerHTML = `
    <h2 style="text-align:center;margin-top:20vh;color:red">
      ❌ Access Denied <br>
      Please open this page via Administration Panel
    </h2>
  `;
  throw new Error("Unauthorized access");
}
async function loadEvents() {
  try {
    const res = await fetch("https://college-hwbb.onrender.com/api/events");
    const data = await res.json();
    const container = document.getElementById("eventsContainer");
    container.innerHTML = "";

    if (data.success && Array.isArray(data.events) && data.events.length > 0) {
      data.events.forEach(event => {
        const div = document.createElement("div");
        div.className = "event-card";

        div.innerHTML = `
          <div class="event-info">
            ${event.image ? `<img src="${event.image}" alt="Event Image">` : ""}
            <strong>${event.title}</strong><br>
            Date: ${event.date || "N/A"}<br>
            <div>${event.description || ""}</div>
          </div>
          <button onclick="deleteEvent('${event.eventId}')">Delete</button>
        `;
        container.appendChild(div);
      });
    } else {
      container.innerHTML = "<p style='text-align:center;color:gray;'>No events posted yet</p>";
    }
  } catch (err) {
    console.error(err);
    document.getElementById("eventsContainer").innerHTML = "<p style='text-align:center;color:red;'>Error loading events</p>";
  }
}

async function deleteEvent(eventId) {
  if (!confirm("Are you sure you want to delete this event?")) return;

  try {
    const res = await fetch(`https://college-hwbb.onrender.com/api/events/${eventId}`, {
      method: "DELETE"
    });
    const data = await res.json();
    if (res.ok && data.success) {
      alert("Event deleted successfully!");
      loadEvents();
    } else {
      alert("Error deleting event: " + (data.message || "Unknown error"));
    }
  } catch (err) {
    console.error(err);
    alert("Error connecting to backend");
  }
}

// Load events on page load
loadEvents();
</script>

</body>
</html>
