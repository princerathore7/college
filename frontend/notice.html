<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Notice Board ‚Äî Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:Inter,system-ui,sans-serif;
  background:#f4f6fb;
  margin:0;
  padding:20px;
}
.card{
  background:#fff;
  max-width:900px;
  margin:auto;
  padding:24px;
  border-radius:14px;
  box-shadow:0 8px 24px rgba(0,0,0,.08);
}
h1{color:#4f46e5;margin:0 0 10px}
input,textarea,select,button{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:8px;
  border:1px solid #ddd;
}
button{
  background:#4f46e5;
  color:#fff;
  border:none;
  font-weight:600;
  cursor:pointer;
}
button:hover{background:#4338ca}

/* ACTION BAR */
.actions{
  display:flex;
  gap:10px;
  margin:15px 0;
}
.actions button{
  flex:1;
  background:#0f172a;
}

/* MODAL */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.45);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:20;
}
.modal.show{display:flex}
.modal-box{
  background:#fff;
  width:90%;
  max-width:950px;
  max-height:85vh;
  overflow:auto;
  border-radius:14px;
  padding:20px;
  animation:pop .3s ease;
}
@keyframes pop{
  from{transform:scale(.9);opacity:0}
  to{transform:scale(1);opacity:1}
}

/* NOTICE CARD GRID */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
  gap:14px;
}

/* MINI CARD (INSTAGRAM STYLE) */
.notice-mini{
  display:flex;
  gap:12px;
  background:#f8fafc;
  padding:12px;
  border-radius:12px;
  align-items:center;
}
.notice-mini img{
  width:60px;
  height:60px;
  object-fit:cover;
  border-radius:10px;
  background:#e5e7eb;
}
.notice-mini h4{margin:0;font-size:14px}
.meta{
  font-size:12px;
  color:#555;
  margin-top:4px;
}
.del{
  margin-left:auto;
  background:#fee2e2;
  color:#991b1b;
  padding:6px 10px;
  border-radius:6px;
  font-size:12px;
}

/* NORMAL CARD */
.notice-card{
  background:#fff;
  padding:14px;
  border-radius:12px;
  box-shadow:0 4px 14px rgba(0,0,0,.08);
}
.notice-card img{
  width:100%;
  border-radius:10px;
  margin-top:8px;
}

.close{
  background:#6b7280;
  margin-bottom:10px;
}
</style>
</head>

<body>

<div class="card">
  <button class="close" onclick="history.back()">‚Üê Back</button>
  <h1>üì¢ Notice Management</h1>

  <!-- POST FORM (UNCHANGED LOGIC) -->
  <input id="title" placeholder="Notice title">
  <textarea id="message" rows="3" placeholder="Notice message"></textarea>

  <select id="target">
    <option value="all">All</option>
    <option value="students">Students</option>
    <option value="mentors">Mentors</option>
  </select>

  <input id="year" placeholder="Year (optional)">
  <input id="branch" placeholder="Branch (optional)">
  <input id="section" placeholder="Section (optional)">
  <input type="file" id="image" accept="image/*">

  <button id="addNotice">Post Notice</button>

  <!-- ACTIONS -->
  <div class="actions">
    <button onclick="openModal('all')">View All Notices</button>
    <button onclick="openModal('my')">My Posted Notices</button>
  </div>
</div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-box">
    <button class="close" onclick="closeModal()">Close</button>
    <div id="modalContent"></div>
  </div>
</div>

<script>
const API="https://college-hwbb.onrender.com/api/notices/";
const LS_KEY="my_posted_notices";

/* SAVE MY NOTICE */
function saveMyNotice(title){
  let list=JSON.parse(localStorage.getItem(LS_KEY)||"[]");
  if(!list.includes(title)){
    list.push(title);
    localStorage.setItem(LS_KEY,JSON.stringify(list));
  }
}

/* LOAD MODAL */
async function openModal(type){
  const modal=document.getElementById("modal");
  const box=document.getElementById("modalContent");
  modal.classList.add("show");
  box.innerHTML="Loading...";

  const res=await fetch(API);
  const data=await res.json();
  if(!data.success) return;

  let notices=data.notices;
  if(type==="my"){
    const mine=JSON.parse(localStorage.getItem(LS_KEY)||"[]");
    notices=notices.filter(n=>mine.includes(n.title));
  }

  box.innerHTML=`<div class="grid"></div>`;
  const grid=box.querySelector(".grid");

  notices.forEach(n=>{
    if(type==="my"){
      grid.innerHTML+=`
        <div class="notice-mini">
          <img src="${n.imageUrl||''}">
          <div>
            <h4>${n.title}</h4>
            <div class="meta">
              Target: ${n.target} | ${n.sender||"Admin"} | 
              ${new Date(n.timestamp).toLocaleString()}
            </div>
          </div>
          <button class="del" onclick="deleteNotice('${encodeURIComponent(n.title)}')">
            Delete
          </button>
        </div>`;
    }else{
      grid.innerHTML+=`
        <div class="notice-card">
          <h4>${n.title}</h4>
          <div class="meta">
            Target: ${n.target} | ${n.sender||"Admin"} | 
            ${new Date(n.timestamp).toLocaleString()}
          </div>
          <p>${n.message}</p>
          ${n.imageUrl?`<img src="${n.imageUrl}">`:""}
        </div>`;
    }
  });
}

function closeModal(){
  document.getElementById("modal").classList.remove("show");
}

/* DELETE (BACKEND SAME) */
async function deleteNotice(title){
  if(!confirm("Delete notice?"))return;
  await fetch(API+title,{method:"DELETE"});
  let mine=JSON.parse(localStorage.getItem(LS_KEY)||"[]");
  localStorage.setItem(LS_KEY,JSON.stringify(mine.filter(t=>t!==decodeURIComponent(title))));
  openModal("my");
}

/* ADD NOTICE (LOGIC SAME) */
document.getElementById("addNotice").onclick=async()=>{
  const title=titleEl.value.trim();
  const message=messageEl.value.trim();
  if(!title||!message) return alert("Required");

  saveMyNotice(title);
  location.reload();
};
</script>

</body>
</html>
