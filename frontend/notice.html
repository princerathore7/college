<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Notice Board</title>

<style>
body{
  font-family:Inter,system-ui,sans-serif;
  background:#f5f6fc;
  margin:0;padding:20px;color:#111
}
.card{
  background:#fff;
  padding:24px;
  border-radius:14px;
  max-width:900px;
  margin:auto;
  box-shadow:0 10px 30px rgba(0,0,0,.08)
}
h1{color:#4f46e5;margin:0 0 12px}

input,textarea,select,button{
  width:100%;padding:12px;margin:8px 0;
  border-radius:8px;border:1px solid #ddd;font-size:14px
}
button{
  background:#4f46e5;color:#fff;
  border:none;font-weight:600;cursor:pointer
}
button:hover{background:#4338ca}

.grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
.muted{font-size:12px;color:#666}

.actions{
  display:flex;gap:10px;margin-top:10px
}
.actions button{flex:1}

/* MODAL */
.modal{
  position:fixed;inset:0;
  background:rgba(0,0,0,.4);
  display:none;align-items:center;justify-content:center;
  z-index:50
}
.modal.show{display:flex}
.modal-box{
  background:#fff;
  width:90%;max-width:850px;
  border-radius:14px;
  padding:20px;
  animation:zoom .3s ease
}
@keyframes zoom{
  from{transform:scale(.9);opacity:0}
  to{transform:scale(1);opacity:1}
}

/* NOTICE CARD SMALL */
.notice-card{
  display:flex;gap:14px;
  border:1px solid #eee;
  padding:12px;border-radius:10px;
  margin-bottom:12px;
  align-items:center;
  transition:.3s
}
.notice-card:hover{
  transform:translateY(-2px);
  box-shadow:0 6px 18px rgba(0,0,0,.08)
}
.notice-card img{
  width:60px;height:60px;
  border-radius:10px;
  object-fit:cover;
  background:#e5e7eb
}
.notice-info{flex:1}
.notice-info h4{margin:0;color:#4f46e5}
.notice-meta{font-size:12px;color:#555;margin-top:4px}

.del{
  background:#fee2e2;color:#991b1b;
  border:1px solid #fca5a5;
  padding:6px 10px;border-radius:6px;
  cursor:pointer
}
</style>
</head>

<body>

<div class="card">
  <button onclick="history.back()" style="background:#6b7280">‚Üê Back</button>
  <h1>üì¢ Notice Management</h1>

  <!-- POST NOTICE -->
  <input id="title" placeholder="Notice title">
  <textarea id="message" rows="3" placeholder="Notice message"></textarea>

  <select id="target">
    <option value="all">All</option>
    <option value="students">Students</option>
    <option value="mentors">Mentors</option>
  </select>

  <div class="grid">
    <select id="year">
      <option value="">All Years</option>
      <option>1st Year</option><option>2nd Year</option>
      <option>3rd Year</option><option>4th Year</option>
    </select>
    <select id="branch">
      <option value="">All Branches</option>
      <option>CSE</option><option>IT</option><option>ECE</option>
      <option>ME</option><option>CE</option>
    </select>
    <select id="section">
      <option value="">All</option>
      <option>1</option><option>2</option><option>3</option>
    </select>
  </div>

  <input type="file" id="image" accept="image/*">
  <button id="addNotice">Add Notice</button>

  <!-- ACTIONS -->
  <div class="actions">
    <button onclick="openAll()">üì¢ View All Notices</button>
    <button onclick="openMine()" style="background:#16a34a">üë§ My Posted Notices</button>
  </div>
</div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-box">
    <h3 id="modalTitle"></h3>
    <div id="modalContent"></div>
    <button onclick="closeModal()" style="margin-top:10px;background:#6b7280">Close</button>
  </div>
</div>

<script>
const API="https://college-hwbb.onrender.com/api/notices/";
const modal=id=>document.getElementById(id);
const myKey="my_posted_notices";

/* ADD NOTICE (backend untouched) */
addNotice.onclick=async()=>{
  const title=titleEl.value=title.value.trim();
  if(!title||!message.value.trim()) return alert("Required");

  const year=yearEl.value=year.value;
  const branch=branch.value;
  const section=section.value;
  let cls=[year,branch+section].join(" ").trim();

  const fd=new FormData();
  fd.append("title",title);
  fd.append("message",message.value);
  fd.append("target",target.value);
  fd.append("sender","Teacher");
  if(cls) fd.append("class",cls);
  if(image.files[0]) fd.append("image",image.files[0]);

  const res=await fetch(API,{method:"POST",body:fd});
  const data=await res.json();
  alert(data.message);

  if(data.success){
    const mine=JSON.parse(localStorage.getItem(myKey)||"[]");
    mine.push({...data.notice});
    localStorage.setItem(myKey,JSON.stringify(mine));
    document.querySelectorAll("input,textarea").forEach(i=>i.value="");
  }
};

/* MODALS */
function openAll(){
  modal("modalTitle").innerText="üì¢ All Notices";
  loadNotices(false);
}
function openMine(){
  modal("modalTitle").innerText="üë§ My Posted Notices";
  loadNotices(true);
}
function closeModal(){
  modal("modal").classList.remove("show");
}

/* LOAD */
async function loadNotices(onlyMine){
  modal("modal").classList.add("show");
  const box=modal("modalContent");
  box.innerHTML="Loading‚Ä¶";

  let notices=[];
  if(onlyMine){
    notices=JSON.parse(localStorage.getItem(myKey)||"[]");
  }else{
    const r=await fetch(API);const d=await r.json();
    notices=d.notices||[];
  }

  box.innerHTML="";
  notices.forEach(n=>{
    box.innerHTML+=`
      <div class="notice-card">
        <img src="${n.imageUrl||''}">
        <div class="notice-info">
          <h4>${n.title}</h4>
          <div class="notice-meta">
            Target: ${n.target} | ${n.sender||"System"} |
            ${new Date(n.timestamp).toLocaleString()}
          </div>
        </div>
        ${onlyMine?`<button class="del" onclick="deleteNotice('${encodeURIComponent(n.title)}')">Delete</button>`:""}
      </div>`;
  });
}

/* DELETE */
async function deleteNotice(title){
  if(!confirm("Delete?"))return;
  await fetch(API+title,{method:"DELETE"});
  let mine=JSON.parse(localStorage.getItem(myKey)||"[]");
  mine=mine.filter(n=>encodeURIComponent(n.title)!==title);
  localStorage.setItem(myKey,JSON.stringify(mine));
  openMine();
}
</script>

</body>
</html>
