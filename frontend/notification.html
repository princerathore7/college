<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üîî Notifications</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family: Arial, sans-serif;
  background:#f4f6f9;
  margin:0;
}
header{
  background:#1e3a8a;
  color:white;
  padding:15px;
  text-align:center;
  font-size:20px;
}
#container{
  padding:15px;
}
.notification{
  background:white;
  border-left:5px solid #2563eb;
  margin-bottom:12px;
  padding:12px;
  border-radius:6px;
  box-shadow:0 2px 5px rgba(0,0,0,0.08);
}
.notification h3{
  margin:0;
  font-size:16px;
}
.notification p{
  margin:6px 0;
  color:#333;
}
.time{
  font-size:12px;
  color:#666;
}
.badge{
  display:inline-block;
  padding:3px 8px;
  font-size:11px;
  border-radius:10px;
  margin-bottom:6px;
  color:white;
}
.global{ background:#16a34a; }
.class{ background:#f97316; }
.personal{ background:#dc2626; }

.empty{
  text-align:center;
  color:#777;
  margin-top:40px;
}
</style>
</head>

<body>

<header>üîî Notifications</header>

<div id="container">
  <div class="empty">Loading notifications...</div>
</div>

<script>
const enrollment   = localStorage.getItem("enrollment");
const studentClass = localStorage.getItem("studentClass");

if(!enrollment){
  document.getElementById("container").innerHTML =
    "<div class='empty'>‚ùå Please login first</div>";
}else{
  fetch(`https://college-hwbb.onrender.com/api/notifications?enrollment=${enrollment}&class=${studentClass}`)

    .then(res => res.json())
    .then(data => {
      const box = document.getElementById("container");
      box.innerHTML = "";

      if(!data.success || data.notifications.length === 0){
        box.innerHTML = "<div class='empty'>No notifications yet</div>";
        return;
      }

      data.notifications.forEach(n => {
        let badgeClass = "global";
        let badgeText  = "GLOBAL";

        if(n.target_type === "class"){
          badgeClass = "class";
          badgeText  = "CLASS";
        }
        if(n.target_type === "enrollment"){
          badgeClass = "personal";
          badgeText  = "PERSONAL";
        }

        box.innerHTML += `
          <div class="notification">
            <span class="badge ${badgeClass}">${badgeText}</span>
            <h3>${n.title}</h3>
            <p>${n.body}</p>
            <div class="time">üïí ${n.timestamp}</div>
          </div>
        `;
      });
    })
    .catch(err => {
      document.getElementById("container").innerHTML =
        "<div class='empty'>‚ö†Ô∏è Failed to load notifications</div>";
      console.error(err);
    });
}
</script>

</body>
</html>
