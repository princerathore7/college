<!DOCTYPE html>
<html>
<head>
  <link rel="icon" href="https://i.ibb.co/8tZSKKT/logo-with-bg.webp">

<meta charset="UTF-8">
<title>Class Notes — Student</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
  body {
    font-family: Inter, sans-serif;
    padding: 20px;
    background: #f3f4f6;
  }

  .card {
    background: #fff;
    max-width: 800px;
    margin: auto;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 3px 12px rgba(0,0,0,0.1);
  }

  label { font-weight: 600; margin-top: 10px; display:block; }

  select, button {
    width: 100%;
    padding: 12px;
    margin-top: 6px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 15px;
  }

  button {
    background: #2563eb;
    color: white;
    font-weight: 600;
    margin-top: 20px;
    cursor: pointer;
  }

  .note-item {
    background: #f9fafb;
    padding: 14px;
    margin-top: 14px;
    border-radius: 8px;
    border: 1px solid #ddd;
  }

  .btn {
    padding: 8px 12px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    font-size: 14px;
  }

  .view { background: #16a34a; color:white; }
  .dl { background: #6b7280; color:white; margin-left:6px;}

  /* ------------ MOBILE RESPONSIVE CSS --------------- */
  @media (max-width: 600px) {

    body {
      padding: 10px;
    }

    .card {
      padding: 15px;
      border-radius: 10px;
    }

    select, button {
      font-size: 14px;
      padding: 10px;
    }

    .note-item {
      padding: 12px;
    }

    .btn {
      width: 100%;
      margin-top: 8px;
    }

    .dl {
      margin-left: 0;
    }
  }
  .back-btn{
  background:#4f46e5;
  color:#fff;
  border:none;
  padding:8px 14px;
  border-radius:8px;
  cursor:pointer;
  font-size:14px;
}
.back-btn:hover{
  opacity:.9;
}

</style>
</head>
<body>

<div class="card">
<button id="backBtn" class="back-btn">⬅ Back</button>

<h2>View Notes / Assignments</h2>

   
    <h4>Acropolis Institute indore</h4>
<label>Select Year</label>
<select id="year">
  <option value="">-- Select --</option>
  <option value="1">1st Year</option>
  <option value="2">2nd Year</option>
  <option value="3">3rd Year</option>
  <option value="4">4th Year</option>
  <option value="5">5th Year</option>
</select>

<label>Select Branch</label>
<select id="branch">
  <option value="">-- Select --</option>

  <!-- (Your full RGPV branch list here) -->
  <option value="CSE">CSE - Computer Science Engineering</option>
  <option value="IT">IT - Information Technology</option>
  <option value="AIML">AIML - Artificial Intelligence & Machine Learning</option>
  <option value="AIDS">AIDS - Artificial Intelligence & Data Science</option>
  <option value="CSBS">CSBS - Computer Science & Business Systems</option>
  <option value="IOT">IoT - Internet of Things</option>
  <option value="ECE">ECE - Electronics & Communication</option>
  <option value="EEE">EEE - Electrical & Electronics</option>
  <option value="EE">EE - Electrical Engineering</option>
  <option value="ME">ME - Mechanical Engineering</option>
  <option value="AU">AU - Automobile Engineering</option>
  <option value="MT">MT - Mechatronics</option>
  <option value="CE">CE - Civil Engineering</option>
  <option value="CHE">CHE - Chemical Engineering</option>
  <option value="MIN">MIN - Mining Engineering</option>
  <option value="PET">PET - Petroleum Engineering</option>
  <option value="BT">BT - Biotechnology</option>
  <option value="BME">BME - Biomedical Engineering</option>
  <option value="FT">FT - Food Technology</option>
  <option value="AG">AG - Agriculture Engineering</option>
  <option value="ENV">ENV - Environmental Engineering</option>
  <option value="TX">TX - Textile Engineering</option>
  <option value="PIE">PIE - Production & Industrial Engineering</option>
  <option value="IM">IM - Industrial Management</option>

  <!-- Diploma -->
  <option value="DCSE">Diploma - Computer Science</option>
  <option value="DIT">Diploma - IT</option>
  <option value="DCYBER">Diploma - Cyber Security</option>
  <option value="DECE">Diploma - ECE</option>
  <option value="DEEE">Diploma - EEE</option>
  <option value="DEE">Diploma - Electrical</option>
  <option value="DME">Diploma - Mechanical</option>
  <option value="DCE">Diploma - Civil</option>
  <option value="DMIN">Diploma - Mining</option>
  <option value="DCHE">Diploma - Chemical</option>
  <option value="DAG">Diploma - Agriculture</option>
  <option value="DTX">Diploma - Textile</option>
  <option value="DPLASTIC">Diploma - Plastic</option>
  <option value="DPOLY">Diploma - Polymer</option>

  <!-- Pharmacy -->
  <option value="DPHARMA">D.Pharmacy</option>
  <option value="BPHARMA">B.Pharmacy</option>
  <option value="MPHARMA">M.Pharmacy</option>
</select>

<label>Select Section</label>
<select id="section">
  <option value="">-- Select --</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="5">5</option>
</select>

<button onclick="fetchNotes()">Load Notes</button>

<div id="notesContainer" style="margin-top:20px;"></div>

</div>

<script>

const API = "https://college-hwbb.onrender.com/api/notes";

function normalizeClass(y,b,s){
  return (y + b + s).toUpperCase();
}

async function fetchNotes(){
  const y = document.getElementById("year").value;
  const b = document.getElementById("branch").value;
  const s = document.getElementById("section").value;
  const out = document.getElementById("notesContainer");

  if(!y || !b || !s){
    out.innerHTML = "<p style='color:red;'>Select all fields.</p>";
    return;
  }

  const className = normalizeClass(y,b,s);
  const display = className.replace(/([0-9]+)([A-Z]+)([0-9]+)/,"$1 $2 $3");

  out.innerHTML = `<p>Loading notes for <b>${display}</b>...</p>`;

  const res = await fetch(`${API}/class/${className}`);
  const data = await res.json();

  if(!data.success || data.notes.length === 0){
    out.innerHTML = `<p>No Notes found for <b>${display}</b></p>`;
    return;
  }

  out.innerHTML = "";

  data.notes.forEach(n => {
    out.innerHTML += `
      <div class="note-item">
        <strong>${n.title}</strong><br>
        <small>${n.subject} | Deadline: ${n.deadline || "Not Given"}</small><br><br>

        <!-- VIEW -->
        <button class="btn view" onclick="viewPDF('${n.noteId}')">View</button>

        <!-- DOWNLOAD -->
        <button class="btn dl" onclick="downloadPDF('${n.noteId}')">Download</button>
      </div>
    `;
  });
}

// Open PDF in browser
function viewPDF(noteId){
  const url = `${API}/${noteId}/file`;
  window.open(url, "_blank");
}

// Download PDF directly
async function downloadPDF(noteId){
  try{
    const res = await fetch(`${API}/${noteId}/direct`);
    const data = await res.json();

    if(!data.success){
      alert("File not found!");
      return;
    }

    const fileUrl = data.url;

    const response = await fetch(fileUrl);
    const blob = await response.blob();

    const link = document.createElement('a');
    link.href = window.URL.createObjectURL(blob);
    link.download = "note.pdf";  // original filename bhi dal sakte ho
    link.click();

  }catch(err){
    alert("Download failed!");
    console.error(err);
  }
}
document.getElementById("backBtn").addEventListener("click", () => {
  history.back();   // ✅ previous page (iframe / admin panel)
});

</script>

</body>
</html>

