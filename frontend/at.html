<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mentor — Attendance Management</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

<style>
  body {
    margin: 0;
    padding: 0;
    background: #f3f4f6;
    font-family: 'Poppins', sans-serif;
    color: #1f2937;
  }

  header {
    background: #6d1b1b;
    color: white;
    padding: 22px;
    font-size: 1.7rem;
    text-align: center;
    font-weight: 600;
    box-shadow: 0 4px 10px rgba(0,0,0,0.25);
  }

  main {
    max-width: 950px;
    margin: 40px auto;
    background: white;
    padding: 30px;
    border-radius: 14px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  }

  h2 {
    margin-bottom: 20px;
    color: #6d1b1b;
    font-size: 1.6rem;
    font-weight: 600;
  }

  select, button {
    padding: 8px 12px;
    margin-right: 10px;
    font-size: 15px;
    border-radius: 6px;
    border: 1px solid #ccc;
  }

  table {
    border-collapse: collapse;
    width: 100%;
    margin-top: 18px;
    font-size: 15px;
  }

  th {
    background: #f7eaea;
    padding: 12px;
    text-align: left;
    color: #6d1b1b;
  }

  td {
    padding: 10px;
    border-bottom: 1px solid #ddd;
  }

  .pBtn, .aBtn {
    padding: 6px 12px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    color: white;
    font-weight: 600;
    margin-right: 6px;
    transition: 0.25s;
  }

  .pBtn { background: #2e7d32; }
  .pBtn:hover { background: #1b5e20; }

  .aBtn { background: #c62828; }
  .aBtn:hover { background: #8e0000; }

  .no-data {
    text-align: center;
    color: gray;
    padding: 20px;
  }
</style>
</head>

<body>

<header>Mentor — Attendance Management</header>

<main>
  <h2>Select Branch & Class</h2>

  <div>
    <!-- Branch Select -->
    <select id="branchSelect">
      <option value="">-- Select Branch --</option>
      <option value="CSE">CSE</option>
      <option value="IT">IT</option>
      <option value="ECE">ECE</option>
      <option value="ME">ME</option>
      <option value="EE">EE</option>
    </select>

    <!-- Class Select with NEW FORMAT -->
    <select id="classSelect">
      <option value="">-- Select Class --</option>

      <!-- 1st Year -->
      <option value="1st Year IT1">1st Year IT 1</option>
      <option value="1st Year IT2">1st Year IT 2</option>
      <option value="1st Year CSE1">1st Year CSE 1</option>
      <option value="1st Year CSE2">1st Year CSE 2</option>

      <!-- 2nd Year -->
      <option value="2nd Year IT1">2nd Year IT 1</option>
      <option value="2nd Year IT2">2nd Year IT 2</option>
      <option value="2nd Year CSE1">2nd Year CSE 1</option>
      <option value="2nd Year CSE2">2nd Year CSE 2</option>
    </select>
  </div>

  <table id="studentTable">
    <thead>
      <tr>
        <th>Enrollment</th>
        <th>Name</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody id="tbody">
      <tr><td colspan="3" class="no-data">Select branch and class</td></tr>
    </tbody>
  </table>
</main>

<script>
  const API_ROOT = "https://college-hwbb.onrender.com/";

  const branchSelect = document.getElementById("branchSelect");
  const classSelect = document.getElementById("classSelect");
  const tbody = document.getElementById("tbody");

  async function loadStudents() {
    const branch = branchSelect.value;
    const class_name = classSelect.value;

    if (!branch || !class_name) {
      tbody.innerHTML = `<tr><td colspan="3" class="no-data">Select branch and class</td></tr>`;
      return;
    }

    tbody.innerHTML = `<tr><td colspan="3" class="no-data">Loading...</td></tr>`;

    try {
      // FIXED WRONG URL
     const res = await fetch(`${API_ROOT}/api/students/${encodeURIComponent(class_name)}`);


      if (!res.ok) {
        tbody.innerHTML = `<tr><td colspan="3" class="no-data">No students found</td></tr>`;
        return;
      }

      const data = await res.json();

      if (!data.success || data.students.length === 0) {
        tbody.innerHTML = `<tr><td colspan="3" class="no-data">No students found</td></tr>`;
        return;
      }

      tbody.innerHTML = "";
      data.students.forEach(s => {
        tbody.innerHTML += `
          <tr>
            <td>${s.enrollment}</td>
            <td>${s.name}</td>
            <td>
              <button class="pBtn" onclick="mark('${s.enrollment}', '${class_name}', 'P')">P</button>
              <button class="aBtn" onclick="mark('${s.enrollment}', '${class_name}', 'A')">A</button>
            </td>
          </tr>
        `;
      });

    } catch (err) {
      console.error(err);
      tbody.innerHTML = `<tr><td colspan="3" class="no-data">Error fetching students</td></tr>`;
    }
  }

  async function mark(enrollment, class_name, status) {
    try {
      const res = await fetch(`${API_ROOT}/api/attendance/mark`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ enrollment, class: class_name, status })
      });

      if (res.ok) {
        alert(`${enrollment} marked ${status}`);
      } else {
        alert("Error marking attendance");
      }
    } catch (err) {
      console.error(err);
      alert("Error marking attendance");
    }
  }

  branchSelect.addEventListener("change", loadStudents);
  classSelect.addEventListener("change", loadStudents);

</script>

</body>
</html>
