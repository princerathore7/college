<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" href="https://i.ibb.co/8tZSKKT/logo-with-bg.webp">

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Salary Management</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
  body{
    font-family:Poppins,sans-serif;
    background:#f8f9fa;
    margin:0;
  }
  header{
    background:linear-gradient(135deg,#004d40,#26a69a);
    color:#fff;
    padding:15px;
    text-align:center;
  }
  main{
    max-width:600px;
    margin:30px auto;
    background:#fff;
    padding:30px;
    border-radius:12px;
    box-shadow:0 4px 12px rgba(0,0,0,.1);
  }
  input,select,button{
    width:100%;
    padding:10px;
    margin:10px 0;
    border-radius:6px;
    border:1px solid #ccc;
    font-size:1rem;
  }
  button{
    background:linear-gradient(135deg,#004d40,#26a69a);
    color:#fff;
    border:none;
    cursor:pointer;
  }
  button:hover{transform:scale(1.03)}

  #loader{
    display:none;
    text-align:center;
    margin-top:10px;
    color:#004d40;
    font-weight:600;
  }
  .spinner{
    border:4px solid #eee;
    border-top:4px solid #26a69a;
    border-radius:50%;
    width:28px;
    height:28px;
    animation:spin 1s linear infinite;
    margin:10px auto;
  }
  @keyframes spin{100%{transform:rotate(360deg)}}

  #successBox{
    display:none;
    background:#e8f5e9;
    color:#2e7d32;
    padding:12px;
    border-radius:6px;
    margin-top:10px;
    text-align:center;
    font-weight:600;
  }
</style>
</head>

<body>

<header>
  <h1>Admin ‚Äî Salary Management</h1>
</header>

<main>
  <h2>Add / Update Mentor Salary</h2>

  <input id="mentorId" placeholder="Mentor ID (e.g. M101)">
  <input id="name" placeholder="Mentor Name">
  <input id="designation" placeholder="Designation">
  <input id="month" placeholder="Month (e.g. October 2025)">
  <input type="number" id="amount" placeholder="Amount (‚Çπ)">

  <select id="status">
    <option value="Pending">Pending</option>
    <option value="Paid">Paid</option>
  </select>

  <button onclick="saveSalary()">Save Salary</button>

  <div id="loader">
    <div class="spinner"></div>
    Updating salary...
  </div>

  <div id="successBox"></div>
</main>

<script>
/* ===============================
   ACCESS CONTROL
================================ */

const mentorId = localStorage.getItem("mentorId");
const source   = sessionStorage.getItem("accessSource");

// allowed sources
const ALLOWED_SOURCES = ["ad", "admin"];

if(!mentorId || !ALLOWED_SOURCES.includes(source)){
  document.body.innerHTML = `
    <h2 style="text-align:center;margin-top:20vh;color:red">
      ‚ùå Access Denied <br>
      Please open this page via Administration Panel
    </h2>
  `;
  throw new Error("Unauthorized access");
}

/* ===============================
   PASSWORD PROTECTION
================================ */
(async ()=>{
  const pwd = prompt("üîê Enter Salary Admin Password:");
  if(!pwd){
    alert("Password required");
    location.href="/ad.html";
    return;
  }

  try{
    const res = await fetch(
      "https://college-hwbb.onrender.com/api/verify-salary-password",
      {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ password: pwd })
      }
    );

    const data = await res.json();
    if(!data.success){
      alert("‚ùå Wrong Password");
      location.href="/ad.html";
    }
  }catch{
    alert("Server error");
    location.href="/ad.html";
  }
})();

/* ===============================
   SAVE SALARY
================================ */
async function saveSalary(){
  const mentorId=document.getElementById("mentorId").value.trim();
  const name=document.getElementById("name").value.trim();
  const designation=document.getElementById("designation").value.trim();
  const month=document.getElementById("month").value.trim();
  const amount=document.getElementById("amount").value.trim();
  const status=document.getElementById("status").value;

  if(!mentorId||!name||!designation||!month||!amount){
    alert("All fields required");
    return;
  }

  document.getElementById("loader").style.display="block";
  document.getElementById("successBox").style.display="none";

  try{
    const res=await fetch(
      "https://college-hwbb.onrender.com/api/salary",
      {
        method:"POST",
        headers:{
          "Content-Type":"application/json",
          "Authorization":"Bearer "+adminToken
        },
        body:JSON.stringify({
          mentorId,name,designation,month,amount,status
        })
      }
    );

    const data=await res.json();
    document.getElementById("loader").style.display="none";

    if(data.success){
      document.getElementById("successBox").innerText=
        "‚úîÔ∏è Salary updated successfully!";
      document.getElementById("successBox").style.display="block";
      document.querySelectorAll("input").forEach(i=>i.value="");
      document.getElementById("status").value="Pending";
      sessionStorage.removeItem("fromAdminPanel");
    }else{
      alert(data.message);
    }
  }catch(err){
    document.getElementById("loader").style.display="none";
    alert("Server error");
  }
}
</script>

</body>
</html>
