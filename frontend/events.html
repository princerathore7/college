<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Exciting Upcoming Events - Student Portal</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
    body {
        margin: 0;
        font-family: "Poppins", "Inter", sans-serif;
        background: #f4f6f9;
        color: #333;
    }
/* TOP BAR */
header {
    background: #99d3ffa1;
    color: #003366;
    padding: 14px 22px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 16px;
    border-bottom: 3px solid #003366;
}

header img {
    height: 60px;
    width: auto;
}

header h1 {
    margin: 0;
    font-size: 1.6rem;
    font-weight: 600;
}


    /* BACK BUTTON */
    .back-btn {
        margin: 18px auto 0;
        display: block;
        padding: 10px 18px;
        background: #003366;
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 15px;
        cursor: pointer;
        transition: background 0.2s ease;
    }

    .back-btn:hover {
        background: #0057ad;
    }

    main {
        max-width: 1200px;
        margin: 25px auto;
        padding: 0 15px;
    }

    /* LOADER */
    .loader {
        border: 5px solid #ddd;
        border-top: 5px solid #003366;
        border-radius: 50%;
        width: 55px;
        height: 55px;
        animation: spin 1s linear infinite;
        margin: 60px auto;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* EVENTS GRID */
    .events-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 18px;
    }

    .event-card {
        background: white;
        border-radius: 10px;
        overflow: hidden;
        cursor: pointer;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .event-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 18px rgba(0,0,0,0.15);
    }

    .event-card img {
        width: 100%;
        height: 170px;
        object-fit: cover;
    }

    .event-card h3 {
        margin: 12px 10px 6px;
        font-size: 1.1rem;
        font-weight: 600;
        text-align: center;
        color: #003366;
    }

    .event-card p {
        margin: 0 10px 14px;
        font-size: 0.9rem;
        text-align: center;
        color: #555;
    }

    .no-events {
        text-align: center;
        color: #777;
        margin-top: 40px;
        font-size: 1rem;
    }

    /* RESPONSIVE */
    @media (max-width: 600px) {
        header {
            flex-direction: column;
            text-align: center;
        }

        header img {
            height: 50px;
        }

        header h1 {
            font-size: 1.4rem;
        }
    }
</style>


</head>
<body>

<header>
  <img src="logo.jpg" alt="Acropolis Logo">
  <h1>üéâ Exciting Upcoming Events üéâ</h1>
</header>

<button class="back-btn" onclick="goBack()">‚Üê Back</button>
<input 
  type="text" 
  id="searchInput" 
  placeholder="üîç Search events by title or description..."
  style="
    display:block;
    margin:15px auto 25px;
    width:100%;
    max-width:420px;
    padding:10px 14px;
    font-size:15px;
    border-radius:6px;
    border:1px solid #ccc;
    outline:none;
  "
>

<main>
  <div id="loader" class="loader"></div>
  <div id="eventsContainer" class="events-grid" style="display:none;"></div>
  <div id="noEvents" class="no-events" style="display:none;">No upcoming events to show.</div>
</main>

<script>
function goBack() {
  window.history.back();
}

let ALL_EVENTS = [];   // üîë store all events

async function loadEvents() {
  const container = document.getElementById("eventsContainer");
  const loader = document.getElementById("loader");
  const noEvents = document.getElementById("noEvents");

  loader.style.display = "block";
  container.style.display = "none";
  noEvents.style.display = "none";

  try {
    const res = await fetch("https://college-hwbb.onrender.com/api/events");
    const data = await res.json();
    loader.style.display = "none";

    if (data.success && Array.isArray(data.events) && data.events.length > 0) {
      ALL_EVENTS = data.events;     // ‚≠ê save all events
      renderEvents(ALL_EVENTS);     // ‚≠ê initial render
    } else {
      noEvents.style.display = "block";
    }
  } catch (err) {
    console.error("Error fetching events:", err);
    loader.style.display = "none";
    noEvents.style.display = "block";
  }
}

/* üîÅ Render events (reuse for search also) */
function renderEvents(events) {
  const container = document.getElementById("eventsContainer");
  const noEvents = document.getElementById("noEvents");

  container.innerHTML = "";

  if (events.length === 0) {
    container.style.display = "none";
    noEvents.style.display = "block";
    return;
  }

  noEvents.style.display = "none";
  container.style.display = "grid";

  events.forEach(ev => {
    const card = document.createElement("div");
    card.className = "event-card";
    card.innerHTML = `
      <img src="${ev.image || 'logo.jpg'}" alt="${ev.title}">
      <h3>${ev.title}</h3>
      <p>${ev.description || "Click this to get the details of this event"}</p>
    `;
    card.onclick = () =>
      window.location.href = `eventDetails.html?eventId=${ev.eventId}`;

    container.appendChild(card);
  });
}

/* üîç REAL-TIME SEARCH FILTER */
document.addEventListener("DOMContentLoaded", () => {
  const searchInput = document.getElementById("searchInput");

  if (!searchInput) return;

  searchInput.addEventListener("input", function () {
    const query = this.value.toLowerCase().trim();

    const filteredEvents = ALL_EVENTS.filter(ev =>
      ev.title?.toLowerCase().includes(query) ||
      ev.description?.toLowerCase().includes(query)
    );

    renderEvents(filteredEvents);   // üî• auto update
  });
});

/* üîî NOTIFICATION PERMISSION (Every 5 Days) */
function requestNotificationPermissionIfNeeded() {
  if (!("Notification" in window)) return;

  if (Notification.permission === "granted") return;

  const LAST_ASK_KEY = "event_notification_last_ask";
  const FIVE_DAYS = 5 * 24 * 60 * 60 * 1000;

  const lastAsk = localStorage.getItem(LAST_ASK_KEY);
  const now = Date.now();

  if (!lastAsk || (now - Number(lastAsk)) > FIVE_DAYS) {
    Notification.requestPermission().then(permission => {
      localStorage.setItem(LAST_ASK_KEY, now.toString());

      if (permission === "granted") {
        new Notification("üéâ Notifications Enabled!", {
          body: "You will now receive updates about new events.",
          icon: "logo.jpg"
        });
      }
    });
  }
}

requestNotificationPermissionIfNeeded();
loadEvents();
</script>

</body>
</html>
