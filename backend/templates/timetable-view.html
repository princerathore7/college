<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Class Timetables â€” Acropolis College</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet" />
<style>
  body {
    font-family: "Poppins", sans-serif;
    background: #f5f6fa;
    margin: 0;
    padding: 0;
    color: #2f3640;
  }
  header {
    background: linear-gradient(135deg, #07505d, #8d6e63);
    color: #fff;
    padding: 15px 20px;
    text-align: center;
    font-family: "Playfair Display", serif;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  }
  main {
    max-width: 1000px;
    margin: 30px auto;
    background: #fff;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  h2 {
    text-align: center;
    margin-bottom: 20px;
    color: #11888c;
    font-family: "Playfair Display", serif;
  }
  .class-list {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 12px;
    margin-bottom: 25px;
  }
  .class-btn {
    background: #177c55;
    color: white;
    border: none;
    padding: 10px 18px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: 0.3s;
  }
  .class-btn:hover {
    background: #1172b8;
    transform: translateY(-2px);
  }
  .pdf-viewer {
    margin-top: 20px;
    display: none;
  }
  iframe {
    width: 100%;
    height: 600px;
    border: none;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }
  .loading {
    text-align: center;
    color: #555;
  }
</style>
</head>
<body>

<header>
  <h1>ðŸ“š Class Timetable Viewer</h1>
</header>

<main>
  <h2>Select Class to View Timetable</h2>
  <div id="classList" class="class-list">
    <p class="loading">Loading classes...</p>
  </div>

  <div id="timetableContainer" class="pdf-viewer"></div>
</main>

<script>
const API_BASE = "https://college-hwbb.onrender.com/api/timetables";

// ðŸ”¹ Load available classes from backend
async function loadClasses() {
  const classList = document.getElementById("classList");
  try {
    const res = await fetch(`${API_BASE}/classes`);
    const data = await res.json();

    if (!data.success || !data.classes || data.classes.length === 0) {
      classList.innerHTML = "<p style='color:#777;'>No classes found.</p>";
      return;
    }

    classList.innerHTML = "";
    data.classes.forEach(cls => {
      const btn = document.createElement("button");
      btn.textContent = cls;
      btn.className = "class-btn";
      btn.onclick = () => loadTimetable(cls);
      classList.appendChild(btn);
    });
  } catch (err) {
    console.error("Error fetching classes:", err);
    classList.innerHTML = "<p style='color:red;'>Failed to load class list.</p>";
  }
}

// ðŸ”¹ Fetch timetable for selected class
async function loadTimetable(className) {
  const container = document.getElementById("timetableContainer");
  container.style.display = "block";
  container.innerHTML = `<p class='loading'>Fetching timetable for <strong>${className}</strong>...</p>`;

  try {
    const res = await fetch(`${API_BASE}?class=${encodeURIComponent(className)}`);
    const data = await res.json();

    if (!data.success || !data.timetables || data.timetables.length === 0) {
      container.innerHTML = `<p style='color:#666;'>No timetable uploaded for <strong>${className}</strong>.</p>`;
      return;
    }

    // Pick latest uploaded timetable
    const latest = data.timetables[data.timetables.length - 1];
    const fileUrl = `${API_BASE}/${latest.timetableId}/file`;

    container.innerHTML = `
      <h3 style="text-align:center; color:#6d1b1b;">Class ${className} Timetable</h3>
      <p style="text-align:center; color:#555;">ðŸ“… Uploaded on: ${new Date(latest.uploadedAt).toLocaleString()}</p>
      <iframe src="${fileUrl}" allowfullscreen></iframe>
    `;
  } catch (err) {
    console.error("Error loading timetable:", err);
    container.innerHTML = `<p style='color:red;'>Error fetching timetable. Please try again.</p>`;
  }
}

window.onload = loadClasses;
</script>

</body>
</html>
