<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Exam Ring — Mentor Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
body { font-family: 'Inter', sans-serif; background:#f3f4f6; margin:0; padding:0; color:#333; }
header { background:#4a90e2; color:#fff; padding:1rem 2rem; text-align:center; }
main { max-width:900px; margin:2rem auto; padding:1rem; background:#fff; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
h1 { margin-top:0; }
label { display:block; margin:0.5rem 0 0.2rem 0; font-weight:600; }
input, select { width:100%; padding:0.5rem; margin-bottom:1rem; border-radius:5px; border:1px solid #ccc; }
button { background:#4a90e2; color:#fff; padding:0.6rem 1rem; border:none; border-radius:5px; cursor:pointer; font-weight:600; margin-right:0.5rem; }
button:hover { background:#357ab8; }
table { width:100%; border-collapse: collapse; margin-top:20px; }
table th, table td { padding:10px; border-bottom:1px solid #ccc; text-align:left; }
table th { background:#f0e6e6; }
.delete-btn { background:#f44336; color:#fff; border:none; border-radius:4px; cursor:pointer; padding:5px 10px; }
.delete-btn:hover { background:#d32f2f; }
</style>
</head>
<body>

<header><h1>Exam Ring — Mentor Dashboard</h1></header>

<main>
  <h2>Post New Exam</h2>
  <label for="examName">Exam Name:</label>
  <input type="text" id="examName" placeholder="Midterm Exam">

  <label for="subject">Subject:</label>
  <input type="text" id="subject" placeholder="Mathematics">

  <label for="date">Date:</label>
  <input type="date" id="date">

  <label for="room">Room:</label>
  <input type="text" id="room" placeholder="101">

  <label for="class">Class:</label>
  <input type="text" id="class" placeholder="1A">

  <button id="postExam">Post Exam</button>

  <h2>Upcoming Exams</h2>
  <table id="examTable">
    <thead>
      <tr>
        <th>Exam Name</th>
        <th>Subject</th>
        <th>Date</th>
        <th>Room</th>
        <th>Class</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</main>

<script>
async function fetchExams() {
  try {
    const res = await fetch("http://localhost:5000/api/exams");
    if(!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
    const data = await res.json();
    const tbody = document.querySelector("#examTable tbody");
    tbody.innerHTML = "";
    if(data.success && Array.isArray(data.exams)){
      data.exams.forEach(exam=>{
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${exam.examName}</td>
          <td>${exam.subject}</td>
          <td>${exam.date}</td>
          <td>${exam.room}</td>
          <td>${exam.class}</td>
          <td><button class="delete-btn" onclick="deleteExam('${exam.examId}')">Delete</button></td>
        `;
        tbody.appendChild(tr);
      });
    }
  } catch(err){
    console.error("Error fetching exams:", err);
    alert("Error fetching exams. Check console.");
  }
}

async function deleteExam(id){
  if(!confirm("Are you sure you want to delete this exam?")) return;
  try{
    const res = await fetch(`http://localhost:5000/api/exams/${id}`, { method:'DELETE' });
    if(!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
    const data = await res.json();
    if(data.success) fetchExams();
    else alert(data.message || "Error deleting exam");
  }catch(err){ console.error(err); alert("Error deleting exam. Check console."); }
}

document.getElementById("postExam").addEventListener("click", async ()=>{
  const examName = document.getElementById("examName").value.trim();
  const subject = document.getElementById("subject").value.trim();
  const date = document.getElementById("date").value;
  const room = document.getElementById("room").value.trim();
  const className = document.getElementById("class").value.trim();

  if(!examName || !subject || !date || !room || !className){
    alert("Please fill all fields"); return;
  }

  try{
    const res = await fetch("http://localhost:5000/api/exams", {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({examName, subject, date, room, class:className})
    });
    if(!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
    const data = await res.json();
    if(data.success){
      alert("Exam posted successfully");
      document.getElementById("examName").value="";
      document.getElementById("subject").value="";
      document.getElementById("date").value="";
      document.getElementById("room").value="";
      document.getElementById("class").value="";
      fetchExams();
    }else{
      alert(data.message || "Error posting exam");
    }
  }catch(err){ console.error(err); alert("Error connecting to backend"); }
});

// Initial fetch
fetchExams();
</script>

</body>
</html>
