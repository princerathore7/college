<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Admin â€” Notice Board</title>
<style>
  body{font-family:Inter,system-ui,sans-serif;background:#f5f6fc;margin:0;padding:20px;color:#111}
  .card{background:#fff;padding:16px;border-radius:12px;max-width:800px;margin:0 auto;box-shadow:0 2px 6px rgba(0,0,0,0.05)}
  h1{margin:0 0 10px 0}
  input,textarea,select,button{width:100%;margin:6px 0;padding:10px;border:1px solid #ddd;border-radius:8px;font-size:14px}
  button{background:#4f46e5;color:#fff;border:none;cursor:pointer;font-weight:600}
  button:hover{background:#4338ca}
  .notice{border:1px solid #eee;padding:12px;border-radius:8px;margin:10px 0}
  .notice h3{margin:0;font-size:16px}
  .meta{font-size:13px;color:#666}
  .del{background:#ffecec;color:#9b1c1c;border:1px solid #f5c6c6;width:auto;margin-top:5px}
</style>
</head>
<body>
  <div class="card">
    <h1>ðŸ“¢ Notice Management (Admin)</h1>

    <h3>Add New Notice</h3>
    <input type="text" id="title" placeholder="Notice Title">
    <textarea id="message" rows="3" placeholder="Notice Message"></textarea>
    <select id="target">
      <option value="all">All</option>
      <option value="students">Students</option>
      <option value="mentors">Mentors</option>
    </select>
    <button id="addNotice">Add Notice</button>

    <hr>

    <h3>All Notices</h3>
    <div id="noticeList"></div>
  </div>

<script>
const API = "http://127.0.0.1:5000/api/notices/";

async function loadNotices(){
  const res = await fetch(API);
  const data = await res.json();
  const container = document.getElementById("noticeList");
  container.innerHTML = "";
  if(!data.success) return alert("Error fetching notices");
  data.notices.forEach(n=>{
    const div = document.createElement("div");
    div.className = "notice";
    div.innerHTML = `
      <h3>${n.title}</h3>
      <div>${n.message}</div>
      <div class="meta">Target: ${n.target} | By: ${n.sender} | ${n.timestamp}</div>
      <button class="del" onclick="deleteNotice('${encodeURIComponent(n.title)}')">Delete</button>
    `;
    container.appendChild(div);
  });
}
async function deleteNotice(title) {
  if (!confirm("Are you sure you want to delete this notice?")) return;

  try {
    const encodedTitle = encodeURIComponent(title);

    // ðŸ§© Base API URL â€” make sure it matches your Flask server
    const API_BASE = "http://127.0.0.1:5000/api/notices";

    const res = await fetch(`${API_BASE}/${encodedTitle}`, {
      method: "DELETE",
      headers: {
        "Content-Type": "application/json"
      }
    });

    // If backend not reachable
    if (!res.ok) {
      throw new Error(`Server returned ${res.status}`);
    }

    const data = await res.json();
    alert(data.message || "Notice deleted successfully!");
    loadNotices();

  } catch (error) {
    console.error("Delete error:", error);
    alert("âŒ Failed to delete notice. Please check backend connection or server logs.");
  }
}



document.getElementById("addNotice").addEventListener("click", async ()=>{
  const title = titleEl.value.trim();
  const message = messageEl.value.trim();
  const target = targetEl.value;
  if(!title || !message) return alert("Title & message required");

  const res = await fetch(API, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({title,message,target,sender:"Admin"})
  });
  const data = await res.json();
  alert(data.message);
  loadNotices();
});

const titleEl = document.getElementById("title");
const messageEl = document.getElementById("message");
const targetEl = document.getElementById("target");

window.addEventListener("load", loadNotices);
</script>
</body>
</html>

