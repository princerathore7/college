<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Preview Event - Mentor Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Inter', sans-serif; margin:0; padding:0; background:#f3f4f6; color:#333; }
  header { background:#4a90e2; color:white; padding:1rem 2rem; text-align:center; }
  main { max-width:900px; margin:2rem auto; padding:1rem; background:white; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
  .event-preview { border:1px solid #ccc; padding:1rem; border-radius:8px; margin-bottom:1rem; background:#fafafa; }
  .event-preview img { max-width:100%; border-radius:5px; margin-bottom:1rem; display:block; }
  .event-preview h2 { margin:0.5rem 0; }
  .event-preview p { margin:0.5rem 0; }
  button { background:#4a90e2; color:white; padding:0.6rem 1rem; border:none; border-radius:5px; cursor:pointer; font-weight:600; margin-right:0.5rem; }
  button:hover { background:#357ab8; }
</style>
</head>
<body>

<header>
  <h1>Preview Event</h1>
</header>

<main>
  <div class="event-preview" id="previewContainer">
    <h2 id="previewTitle"></h2>
    <img id="previewImage" src="" alt="Event Image">
    <p id="previewDate"></p>
    <div id="previewDescription"></div>
  </div>

  <button id="confirmEvent">Confirm & Post Event</button>
  <button id="editEvent">Edit Event</button>
</main>

<script>
  // ðŸ”¹ Load event data from sessionStorage
  const eventData = JSON.parse(sessionStorage.getItem("eventPreview") || "{}");

  if (!eventData || !eventData.title) {
    alert("No event data found! Redirecting back to design page.");
    window.location.href = "design.html";
  }

  // ðŸ”¹ Fill preview
  document.getElementById("previewTitle").textContent = eventData.title || "";
  const descEl = document.getElementById("previewDescription");
  descEl.innerHTML = eventData.description || "";

  const imgEl = document.getElementById("previewImage");
  if (eventData.image && eventData.image.trim() !== "") {
    imgEl.src = eventData.image.trim();
    imgEl.style.display = "block";
    imgEl.onerror = () => { imgEl.style.display = "none"; };
  } else {
    imgEl.style.display = "none";
  }

  document.getElementById("previewDate").textContent = eventData.date ? "Date: " + eventData.date : "";

  // ðŸ”¹ Confirm & post to backend (JSON with Cloudinary URL)
  document.getElementById("confirmEvent").addEventListener("click", async () => {
    try {
      const res = await fetch("http://localhost:5000/api/events", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(eventData) // image URL already in eventData.image
      });
      const data = await res.json();
      if(res.ok && data.success) {
        alert("Event posted successfully!");
        sessionStorage.removeItem("eventPreview");
        window.location.href = "events.html"; // redirect to events list
      } else {
        alert("Error posting event: " + (data.message || "Unknown error"));
      }
    } catch(err) {
      console.error(err);
      alert("Error connecting to backend");
    }
  });

  // ðŸ”¹ Edit event â†’ back to design.html
  document.getElementById("editEvent").addEventListener("click", () => {
    window.location.href = "design.html";
  });
</script>

</body>
</html>
