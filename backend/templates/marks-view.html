<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Marks — Student View</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet"/>
<style>
  body{font-family:'Poppins',sans-serif;background:#f7fafc;margin:0;padding:24px;color:#1f2937}
  .card{max-width:680px;margin:18px auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 6px 18px rgba(2,6,23,0.08)}
  h1{margin:0 0 14px 0;color:#0f172a}
  .row{display:flex;gap:12px}
  .col{flex:1}
  table{width:100%;border-collapse:collapse;margin-top:12px}
  th,td{padding:10px;border-bottom:1px solid #e6eef7;text-align:left}
  .badge{padding:6px 10px;border-radius:8px;color:#fff;font-weight:700}
  .badge.good{background:#16a34a}
</style>
</head>
<body>
  <div class="card">
    <h1>Your Marks</h1>
    <label>Enter Enrollment ID to load:</label>
    <input id="enr" type="text" placeholder="EN001" style="padding:8px;width:100%;margin-top:8px;border-radius:8px;border:1px solid #dbeafe"/>
    <div style="margin-top:12px;display:flex;gap:8px;">
      <button onclick="loadMarks()" style="padding:8px 12px;border-radius:8px;border:none;background:#0f172a;color:#fff;font-weight:700">Load</button>
      <button onclick="useStored()" style="padding:8px 12px;border-radius:8px;border:1px solid #d1d5db;background:#fff">Use saved enrollment</button>
    </div>

    <div id="result" style="margin-top:16px;display:none">
      <h3 id="studentName"></h3>
      <table>
        <tr><th>MST</th><td id="mst">0</td></tr>
        <tr><th>Internal</th><td id="internal">0</td></tr>
        <tr><th>Assignments</th><td id="assignments">0</td></tr>
        <tr><th>Percentage</th><td><span id="percentage" class="badge good">0%</span></td></tr>
      </table>
    </div>
  </div>

<script>
function useStored(){
  const e = localStorage.getItem('enrollment');
  if(!e) return alert('No stored enrollment');
  document.getElementById('enr').value = e;
  loadMarks();
}

async function loadMarks(){
  const enr = document.getElementById('enr').value.trim();
  if(!enr) return alert('Enter enrollment');
  try{
    const res = await fetch(`https://college-hwbb.onrender.com/api/marks/${encodeURIComponent(enr)}`);
    if(!res.ok){
      const err = await res.json();
      return alert(err.message || 'Failed to fetch');
    }
    const data = await res.json();
    const m = data.marks;
    document.getElementById('studentName').innerText = `${m.name || 'Student'} — ${m.enrollment}`;
    document.getElementById('mst').innerText = m.mst;
    document.getElementById('internal').innerText = m.internal;
    document.getElementById('assignments').innerText = m.assignments;
    document.getElementById('percentage').innerText = m.percentage + '%';
    document.getElementById('result').style.display = 'block';
  }catch(err){
    console.error(err);
    alert('Error loading marks');
  }
}
</script>
</body>
</html>
